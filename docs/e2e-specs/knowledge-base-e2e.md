# KnowledgeBasePage（D-005）E2Eテスト仕様書

生成日: 2025-11-02
対象ページ: /admin/knowledge
テスト環境: モック実装
作成者: E2Eテスト設計サブエージェント

## 概要
- 総テスト項目数: 67
- 高優先度: 39項目
- 中優先度: 20項目
- 低優先度: 8項目

## テスト項目一覧

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 1 | E2E-KB-001 | ページアクセス（コーチロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | コーチロールでのナレッジベース管理アクセス | 1. コーチアカウントでログイン（coach@rag-base.local）<br>2. `/admin/knowledge`にアクセス | ・ナレッジベース管理ページが表示される<br>・ページタイトル「ナレッジベース管理」表示<br>・左側: ナレッジベース一覧（40%幅）<br>・右側: ドキュメント管理（60%幅） | | | |
| 2 | E2E-KB-002 | ページアクセス（クライアントロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | クライアントロールのアクセス拒否 | 1. クライアントアカウントでログイン（client1@rag-base.local）<br>2. `/admin/knowledge`に直接アクセス | ・403 Forbiddenエラー表示<br>・または、クライアント向けチャットページ（/chat）にリダイレクト<br>・エラーメッセージ「管理者権限が必要です」表示 | | | |
| 3 | E2E-KB-003 | ページアクセス（未認証） | なし | 認証・アクセス制御 | セキュリティ | 高 | 未ログイン時のアクセス制御 | 1. ログアウト状態<br>2. `/admin/knowledge`に直接アクセス | ・ログインページにリダイレクト<br>・エラーメッセージ表示（要ログイン） | | | |
| 4 | E2E-KB-004 | ナレッジベース一覧取得（成功） | E2E-KB-001 | データ取得 | 正常系 | 高 | API呼び出しとナレッジベース一覧表示 | 1. コーチアカウントでログイン<br>2. ナレッジベース管理ページにアクセス<br>3. ネットワークタブでAPIリクエスト確認 | ・`GET /v1/datasets`が実行される<br>・ローディング表示が出る<br>・ナレッジベース一覧が正常に表示される（システムRAG、ユーザーRAG）<br>・エラーなし | | | |
| 5 | E2E-KB-005 | ナレッジベースカード：システムRAG | E2E-KB-004 | ナレッジベース一覧表示 | 正常系 | 高 | システムRAGカードの表示 | 1. ナレッジベース管理ページ表示<br>2. システムRAGカードを確認 | ・カードタイトル「システムRAG - コーチング理論体系」<br>・タイプバッジ「システムRAG」（青色）<br>・ドキュメント数「15件」表示<br>・チャンク数「342件」表示<br>・更新日時表示 | | | |
| 6 | E2E-KB-006 | ナレッジベースカード：ユーザーRAG | E2E-KB-004 | ナレッジベース一覧表示 | 正常系 | 高 | ユーザーRAGカードの表示 | 1. ナレッジベース管理ページ表示<br>2. ユーザーRAGカードを確認 | ・カードタイトル「ユーザーRAG_client1」<br>・タイプバッジ「ユーザーRAG」（緑色）<br>・ドキュメント数「8件」表示<br>・チャンク数「156件」表示<br>・更新日時表示 | | | |
| 7 | E2E-KB-007 | ナレッジベースカードクリック（選択） | E2E-KB-005 | ナレッジベース選択 | 正常系 | 高 | ナレッジベースカード選択時の表示変化 | 1. ナレッジベース管理ページ表示<br>2. システムRAGカードをクリック | ・選択されたカードに青色ボーダー（2px solid #2c5282）が表示される<br>・右側にドキュメント一覧が表示される<br>・`GET /v1/datasets/{dataset_id}/documents`が実行される | | | |
| 8 | E2E-KB-008 | ナレッジベースカード切り替え | E2E-KB-007 | ナレッジベース選択 | 正常系 | 高 | ナレッジベース切り替え時の表示 | 1. システムRAGカード選択中<br>2. ユーザーRAGカードをクリック | ・システムRAGカードのボーダーが消える<br>・ユーザーRAGカードに青色ボーダーが表示される<br>・右側のドキュメント一覧がユーザーRAGのものに切り替わる<br>・新しい`GET /v1/datasets/{dataset_id}/documents`が実行される | | | |
| 9 | E2E-KB-009 | チャンク設定：チャンクサイズスライダー | E2E-KB-007 | チャンク設定 | 正常系 | 高 | チャンクサイズスライダーの操作 | 1. ナレッジベース管理ページ表示<br>2. システムRAGカード選択<br>3. チャンクサイズスライダーを500→800に変更 | ・スライダーが800に変化<br>・数値表示が「800トークン」に更新<br>・「設定を保存」ボタンが有効になる | | | |
| 10 | E2E-KB-010 | チャンク設定：オーバーラップスライダー | E2E-KB-007 | チャンク設定 | 正常系 | 高 | オーバーラップスライダーの操作 | 1. ナレッジベース管理ページ表示<br>2. システムRAGカード選択<br>3. オーバーラップスライダーを50→100に変更 | ・スライダーが100に変化<br>・数値表示が「100トークン」に更新<br>・「設定を保存」ボタンが有効になる | | | |
| 11 | E2E-KB-011 | チャンク設定：設定保存 | E2E-KB-009 | チャンク設定 | 正常系 | 高 | チャンク設定保存の実行 | 1. システムRAGカード選択<br>2. チャンクサイズを800、オーバーラップを100に変更<br>3. 「設定を保存」ボタンをクリック | ・`PUT /v1/datasets/{dataset_id}/settings`が実行される<br>・成功メッセージ「設定を保存しました」表示<br>・「設定を保存」ボタンが無効に戻る<br>・ナレッジベースカードの更新日時が更新される | | | |
| 12 | E2E-KB-012 | チャンク設定：範囲外の値（チャンクサイズ） | E2E-KB-007 | チャンク設定 | 異常系 | 中 | チャンクサイズ範囲外の値の制限 | 1. システムRAGカード選択<br>2. チャンクサイズスライダーを最小（100）未満にしようとする | ・スライダーが100より小さくならない<br>・スライダーが1000より大きくならない<br>・数値表示が100-1000の範囲内 | | | |
| 13 | E2E-KB-013 | チャンク設定：範囲外の値（オーバーラップ） | E2E-KB-007 | チャンク設定 | 異常系 | 中 | オーバーラップ範囲外の値の制限 | 1. システムRAGカード選択<br>2. オーバーラップスライダーを最小（0）未満にしようとする | ・スライダーが0より小さくならない<br>・スライダーが200より大きくならない<br>・数値表示が0-200の範囲内 | | | |
| 14 | E2E-KB-014 | ドキュメント一覧取得（成功） | E2E-KB-007 | データ取得 | 正常系 | 高 | ドキュメント一覧の表示 | 1. システムRAGカード選択<br>2. ネットワークタブでAPIリクエスト確認 | ・`GET /v1/datasets/{dataset_id}/documents`が実行される<br>・ドキュメント一覧テーブルが表示される<br>・列: ファイル名、種別、アップロード日時、ステータス、チャンク数、アクション | | | |
| 15 | E2E-KB-015 | ドキュメントテーブル：ファイル名表示 | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | ファイル名の表示 | 1. システムRAGカード選択<br>2. ドキュメントテーブルを確認 | ・ファイル名「コーチング基礎理論.pdf」表示<br>・ファイル名「傾聴スキル実践ガイド.docx」表示<br>・ファイル名「質問技法まとめ.txt」表示 | | | |
| 16 | E2E-KB-016 | ドキュメントテーブル：種別バッジ表示 | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | ファイル種別バッジの表示 | 1. システムRAGカード選択<br>2. ドキュメントテーブルの種別列を確認 | ・PDFファイル: 赤色バッジ「PDF」<br>・DOCXファイル: 青色バッジ「DOCX」<br>・TXTファイル: 灰色バッジ「TXT」 | | | |
| 17 | E2E-KB-017 | ドキュメントテーブル：ステータス表示（完了） | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | ベクトル化完了ステータスの表示 | 1. システムRAGカード選択<br>2. ステータス列を確認 | ・status="completed"のドキュメント: 緑色バッジ「完了」<br>・ベクトル化完了日時表示 | | | |
| 18 | E2E-KB-018 | ドキュメントテーブル：ステータス表示（処理中） | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | ベクトル化処理中ステータスの表示 | 1. システムRAGカード選択<br>2. ステータス列を確認 | ・status="processing"のドキュメント: 黄色バッジ「処理中」<br>・進捗アニメーション表示（オプション） | | | |
| 19 | E2E-KB-019 | ドキュメントテーブル：ステータス表示（エラー） | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | ベクトル化エラーステータスの表示 | 1. モックデータにstatus="failed"のドキュメントを追加<br>2. ステータス列を確認 | ・status="failed"のドキュメント: 赤色バッジ「エラー」<br>・エラーメッセージ表示（オプション） | | | |
| 20 | E2E-KB-020 | ドキュメントテーブル：チャンク数表示 | E2E-KB-014 | ドキュメント一覧表示 | 正常系 | 高 | チャンク数の表示 | 1. システムRAGカード選択<br>2. チャンク数列を確認 | ・「45チャンク」表示<br>・「23チャンク」表示<br>・処理中の場合「0チャンク」表示 | | | |
| 21 | E2E-KB-021 | ドキュメントアップロードボタンクリック | E2E-KB-007 | ドキュメントアップロード | 正常系 | 高 | アップロードモーダルの表示 | 1. システムRAGカード選択<br>2. 「ドキュメントをアップロード」ボタンをクリック | ・アップロードモーダルが表示される<br>・タイトル「ドキュメントをアップロード」<br>・ファイル選択エリア表示<br>・「キャンセル」「アップロード」ボタン表示 | | | |
| 22 | E2E-KB-022 | ドキュメントアップロード：ファイル選択 | E2E-KB-021 | ドキュメントアップロード | 正常系 | 高 | ファイル選択エリアの動作 | 1. アップロードモーダル表示<br>2. ファイル選択エリアをクリック<br>3. PDFファイルを選択 | ・ファイル選択ダイアログが表示される<br>・ファイルを選択<br>・ファイル名が表示される（例: コーチング新理論.pdf）<br>・「アップロード」ボタンが有効になる | | | |
| 23 | E2E-KB-023 | ドキュメントアップロード：ドラッグ&ドロップ | E2E-KB-021 | ドキュメントアップロード | 正常系 | 高 | ドラッグ&ドロップでのファイル選択 | 1. アップロードモーダル表示<br>2. PDFファイルをドラッグ&ドロップ | ・ファイル選択エリアにドラッグ時、ハイライト表示<br>・ドロップ後、ファイル名が表示される<br>・「アップロード」ボタンが有効になる | | | |
| 24 | E2E-KB-024 | ドキュメントアップロード：アップロード実行（PDF） | E2E-KB-022 | ドキュメントアップロード | 正常系 | 高 | PDFファイルのアップロード実行 | 1. アップロードモーダル表示<br>2. PDFファイルを選択<br>3. 「アップロード」ボタンをクリック | ・`POST /v1/datasets/{dataset_id}/documents`が実行される（FormData）<br>・成功メッセージ「ドキュメントをアップロードしました」表示<br>・モーダルが閉じる<br>・ドキュメント一覧に新規ドキュメントが追加される（status="pending"） | | | |
| 25 | E2E-KB-025 | ドキュメントアップロード：アップロード実行（DOCX） | E2E-KB-022 | ドキュメントアップロード | 正常系 | 高 | DOCXファイルのアップロード実行 | 1. アップロードモーダル表示<br>2. DOCXファイルを選択<br>3. 「アップロード」ボタンをクリック | ・`POST /v1/datasets/{dataset_id}/documents`が実行される<br>・成功メッセージ表示<br>・モーダルが閉じる<br>・ドキュメント一覧に追加される | | | |
| 26 | E2E-KB-026 | ドキュメントアップロード：アップロード実行（TXT） | E2E-KB-022 | ドキュメントアップロード | 正常系 | 高 | TXTファイルのアップロード実行 | 1. アップロードモーダル表示<br>2. TXTファイルを選択<br>3. 「アップロード」ボタンをクリック | ・`POST /v1/datasets/{dataset_id}/documents`が実行される<br>・成功メッセージ表示<br>・モーダルが閉じる<br>・ドキュメント一覧に追加される | | | |
| 27 | E2E-KB-027 | ドキュメントアップロード：対応外フォーマット（PNG） | E2E-KB-021 | ドキュメントアップロード | 異常系 | 高 | 対応外ファイル形式のエラー | 1. アップロードモーダル表示<br>2. PNGファイルを選択<br>3. 「アップロード」ボタンをクリック | ・エラーメッセージ「対応していないファイル形式です。PDF、DOCX、TXTのみアップロード可能です。」<br>・APIリクエストは送信されない（クライアント側で検証）<br>・または、APIが400エラーを返す | | | |
| 28 | E2E-KB-028 | ドキュメントアップロード：最大サイズ超過 | E2E-KB-021 | ドキュメントアップロード | 異常系 | 高 | 10MB超ファイルのエラー | 1. アップロードモーダル表示<br>2. 10MBを超えるPDFファイルを選択<br>3. 「アップロード」ボタンをクリック | ・エラーメッセージ「ファイルサイズが10MBを超えています。」<br>・APIリクエストは送信されない（クライアント側で検証）<br>・または、APIが400エラーを返す | | | |
| 29 | E2E-KB-029 | ドキュメントアップロード：キャンセル | E2E-KB-022 | ドキュメントアップロード | 正常系 | 中 | アップロードキャンセル | 1. アップロードモーダル表示<br>2. ファイルを選択<br>3. 「キャンセル」ボタンをクリック | ・モーダルが閉じる<br>・APIリクエストは送信されない<br>・ドキュメント一覧に変化なし | | | |
| 30 | E2E-KB-030 | ドキュメント削除ボタンクリック | E2E-KB-014 | ドキュメント削除 | 正常系 | 高 | 削除確認モーダルの表示 | 1. システムRAGカード選択<br>2. ドキュメント一覧からstatus="completed"のドキュメントの「削除」ボタンをクリック | ・削除確認モーダルが表示される<br>・タイトル「ドキュメントを削除しますか？」<br>・メッセージ「ドキュメント「コーチング基礎理論.pdf」とそのベクトルデータを削除します。この操作は取り消せません。」<br>・「キャンセル」「削除」ボタン表示 | | | |
| 31 | E2E-KB-031 | ドキュメント削除：削除実行 | E2E-KB-030 | ドキュメント削除 | 正常系 | 高 | ドキュメント削除の実行 | 1. 削除確認モーダル表示<br>2. 「削除」ボタンをクリック | ・`DELETE /v1/datasets/{dataset_id}/documents/{document_id}`が実行される<br>・成功メッセージ「ドキュメントを削除しました」表示<br>・モーダルが閉じる<br>・ドキュメント一覧から削除されたドキュメントが消える<br>・ナレッジベースカードのドキュメント数とチャンク数が更新される | | | |
| 32 | E2E-KB-032 | ドキュメント削除：キャンセル | E2E-KB-030 | ドキュメント削除 | 正常系 | 中 | 削除キャンセル | 1. 削除確認モーダル表示<br>2. 「キャンセル」ボタンをクリック | ・モーダルが閉じる<br>・APIリクエストは送信されない<br>・ドキュメント一覧に変化なし | | | |
| 33 | E2E-KB-033 | ドキュメント削除：処理中ドキュメントの削除不可 | E2E-KB-014 | ドキュメント削除 | 異常系 | 高 | 処理中ドキュメントの削除制限 | 1. システムRAGカード選択<br>2. status="processing"のドキュメントの「削除」ボタンを確認 | ・「削除」ボタンが無効化されている<br>・ツールチップ「ベクトル化処理中のドキュメントは削除できません」表示（オプション） | | | |
| 34 | E2E-KB-034 | 検索精度テスト：テストパネル表示 | E2E-KB-007 | 検索精度テスト | 正常系 | 中 | 検索精度テストパネルの表示 | 1. システムRAGカード選択<br>2. 右側のドキュメント管理エリアを確認 | ・検索精度テストパネルが表示される<br>・検索クエリ入力フィールド<br>・Top K設定スライダー（1-20）<br>・「テスト実行」ボタン | | | |
| 35 | E2E-KB-035 | 検索精度テスト：クエリ入力 | E2E-KB-034 | 検索精度テスト | 正常系 | 中 | 検索クエリの入力 | 1. 検索精度テストパネル表示<br>2. 検索クエリフィールドに「コーチングの傾聴スキルとは」と入力 | ・クエリが入力される<br>・「テスト実行」ボタンが有効になる | | | |
| 36 | E2E-KB-036 | 検索精度テスト：Top K設定 | E2E-KB-034 | 検索精度テスト | 正常系 | 中 | Top K値の設定 | 1. 検索精度テストパネル表示<br>2. Top Kスライダーを5→10に変更 | ・スライダーが10に変化<br>・数値表示が「10件」に更新 | | | |
| 37 | E2E-KB-037 | 検索精度テスト：テスト実行 | E2E-KB-035 | 検索精度テスト | 正常系 | 中 | 検索精度テストの実行 | 1. 検索クエリ入力<br>2. Top Kを5に設定<br>3. 「テスト実行」ボタンをクリック | ・`POST /v1/datasets/{dataset_id}/search-test`が実行される（query, top_k）<br>・ローディング表示<br>・検索結果が表示される（5件）<br>・各結果: ファイル名、チャンク内容、類似度スコア、チャンク位置 | | | |
| 38 | E2E-KB-038 | 検索精度テスト：検索結果表示 | E2E-KB-037 | 検索精度テスト | 正常系 | 中 | 検索結果の詳細表示 | 1. 検索精度テスト実行<br>2. 検索結果を確認 | ・結果1: ファイル名「コーチング基礎理論.pdf」、スコア0.87（濃い緑色）<br>・結果2: ファイル名「傾聴スキル実践ガイド.docx」、スコア0.82（濃い緑色）<br>・各結果のチャンク内容が表示される<br>・類似度スコアがバーグラフまたは数値で表示される | | | |
| 39 | E2E-KB-039 | 検索精度テスト：類似度スコア色分け | E2E-KB-038 | 検索精度テスト | 正常系 | 低 | 類似度スコアの色分け表示 | 1. 検索精度テスト実行<br>2. 検索結果の類似度スコアを確認 | ・スコア0.8-1.0: 濃い緑色<br>・スコア0.6-0.8: 黄色<br>・スコア0.0-0.6: 灰色 | | | |
| 40 | E2E-KB-040 | 検索精度テスト：クエリが空 | E2E-KB-034 | 検索精度テスト | 異常系 | 中 | 空のクエリでのテスト実行 | 1. 検索精度テストパネル表示<br>2. クエリを空のまま「テスト実行」ボタンをクリック | ・「テスト実行」ボタンが無効<br>・または、エラーメッセージ「検索クエリを入力してください」表示 | | | |
| 41 | E2E-KB-041 | レイアウト：2カラム（デスクトップ） | E2E-KB-001 | UI表示 | 正常系 | 中 | デスクトップ画面での2カラムレイアウト | 1. ブラウザ幅1920pxに設定<br>2. ナレッジベース管理ページ表示 | ・左側: ナレッジベース一覧（40%幅）<br>・右側: ドキュメント管理（60%幅）<br>・2カラムが横並び表示<br>・カラム間に適切な余白 | | | |
| 42 | E2E-KB-042 | レイアウト：1カラム（タブレット） | E2E-KB-001 | UI表示 | レスポンシブ | 低 | タブレット画面での1カラムレイアウト | 1. ブラウザ幅768pxに設定<br>2. ナレッジベース管理ページ表示 | ・1カラムレイアウト（縦並び）<br>・ナレッジベース一覧が上部<br>・ドキュメント管理が下部<br>・縦スクロール可能 | | | |
| 43 | E2E-KB-043 | レイアウト：1カラム（モバイル） | E2E-KB-001 | UI表示 | レスポンシブ | 低 | モバイル画面での1カラムレイアウト | 1. ブラウザ幅375pxに設定<br>2. ナレッジベース管理ページ表示 | ・1カラムレイアウト（縦並び）<br>・ナレッジベース一覧が上部<br>・ドキュメント管理が下部<br>・縦スクロール可能<br>・横スクロールなし | | | |
| 44 | E2E-KB-044 | ローディング表示：ナレッジベース一覧 | E2E-KB-001 | データ取得 | 正常系 | 中 | ナレッジベース一覧取得中のローディング | 1. ナレッジベース管理ページにアクセス<br>2. APIレスポンス前の状態を確認 | ・ローディングスピナー表示<br>・「読み込み中...」テキスト表示<br>・ナレッジベース一覧カード非表示 | | | |
| 45 | E2E-KB-045 | ローディング表示：ドキュメント一覧 | E2E-KB-007 | データ取得 | 正常系 | 中 | ドキュメント一覧取得中のローディング | 1. ナレッジベースカード選択<br>2. APIレスポンス前の状態を確認 | ・ローディングスピナー表示<br>・「読み込み中...」テキスト表示<br>・ドキュメントテーブル非表示 | | | |
| 46 | E2E-KB-046 | エラーハンドリング：ナレッジベース一覧取得エラー | E2E-KB-001 | エラーハンドリング | 異常系 | 高 | API接続エラー時のエラー表示 | 1. ネットワークを切断<br>2. ナレッジベース管理ページにアクセス | ・エラーアラート表示（MUI Alert、severity="error"）<br>・メッセージ「ナレッジベース一覧の取得に失敗しました」<br>・ナレッジベース一覧カード非表示<br>・コンソールにエラーログ出力 | | | |
| 47 | E2E-KB-047 | エラーハンドリング：ドキュメント一覧取得エラー | E2E-KB-007 | エラーハンドリング | 異常系 | 高 | ドキュメント一覧取得エラー | 1. ナレッジベースカード選択<br>2. モックAPIを404エラーに設定<br>3. ネットワークタブで確認 | ・エラーアラート表示<br>・メッセージ「ドキュメント一覧の取得に失敗しました」<br>・ドキュメントテーブル非表示 | | | |
| 48 | E2E-KB-048 | エラーハンドリング：アップロードエラー | E2E-KB-024 | エラーハンドリング | 異常系 | 高 | アップロード失敗時のエラー表示 | 1. アップロードモーダル表示<br>2. ファイル選択<br>3. モックAPIを500エラーに設定<br>4. アップロード実行 | ・エラーメッセージ「ドキュメントのアップロードに失敗しました」<br>・モーダルは閉じない<br>・ユーザーが再試行可能 | | | |
| 49 | E2E-KB-049 | エラーハンドリング：削除エラー | E2E-KB-031 | エラーハンドリング | 異常系 | 高 | 削除失敗時のエラー表示 | 1. 削除確認モーダル表示<br>2. モックAPIを500エラーに設定<br>3. 削除実行 | ・エラーメッセージ「ドキュメントの削除に失敗しました」<br>・モーダルが閉じる<br>・ドキュメント一覧に変化なし | | | |
| 50 | E2E-KB-050 | エラーハンドリング：設定保存エラー | E2E-KB-011 | エラーハンドリング | 異常系 | 高 | 設定保存失敗時のエラー表示 | 1. チャンク設定変更<br>2. モックAPIを500エラーに設定<br>3. 設定保存実行 | ・エラーメッセージ「設定の保存に失敗しました」<br>・設定が元の値に戻る<br>・「設定を保存」ボタンが有効のまま | | | |
| 51 | E2E-KB-051 | セキュリティ：他ロールのアクセス試行 | E2E-KB-002 | セキュリティ | セキュリティ | 高 | クライアントロールでの不正アクセス防止 | 1. クライアントアカウントでログイン<br>2. URLを直接入力して`/admin/knowledge`にアクセス<br>3. ブラウザ開発者ツールでリクエスト確認 | ・403 Forbiddenエラー<br>・または、/chatにリダイレクト<br>・APIリクエストは送信されない（フロントエンド側で制御）<br>・または、APIが403を返す（バックエンド側で制御） | | | |
| 52 | E2E-KB-052 | セキュリティ：APIエンドポイントの直接アクセス | E2E-KB-001 | セキュリティ | セキュリティ | 高 | クライアントロールによるAPI直接アクセス防止 | 1. クライアントアカウントでログイン<br>2. ブラウザコンソールで`fetch('/v1/datasets')`を実行 | ・403 Forbiddenエラー<br>・エラーレスポンス:<br>　{<br>　　"error": "forbidden",<br>　　"message": "コーチロールのみアクセス可能です",<br>　　"status": 403<br>　} | | | |
| 53 | E2E-KB-053 | セキュリティ：トークン期限切れ | E2E-KB-001 | セキュリティ | セキュリティ | 高 | トークン期限切れ時の挙動 | 1. コーチアカウントでログイン<br>2. トークン有効期限を過ぎた状態をシミュレート（localStorageのトークンを削除）<br>3. ナレッジベース管理ページにアクセス | ・401 Unauthorizedエラー<br>・ログインページにリダイレクト<br>・エラーメッセージ「セッションが期限切れです。再度ログインしてください。」 | | | |
| 54 | E2E-KB-054 | パフォーマンス：初期ロード時間 | E2E-KB-001 | パフォーマンス | 正常系 | 中 | ページ初期ロード速度 | 1. ページロード時のパフォーマンスを測定 | ・ページが3秒以内に表示される<br>・ナレッジベース一覧API呼び出し完了まで500ms以内（モック300ms遅延）<br>・First Contentful Paint < 1.5秒<br>・Time to Interactive < 3秒 | | | |
| 55 | E2E-KB-055 | パフォーマンス：ドキュメント一覧取得時間 | E2E-KB-007 | パフォーマンス | 正常系 | 中 | ドキュメント一覧API応答時間 | 1. ナレッジベースカード選択<br>2. ネットワークタブでAPI応答時間を測定 | ・APIレスポンスが500ms以内（モック実装）<br>・本番環境では500ms-1秒を目標 | | | |
| 56 | E2E-KB-056 | ワークフロー：初回アクセスからアップロードまで | なし | ワークフロー | 正常系 | 高 | コーチが初めてナレッジベース管理にアクセスし、ドキュメントをアップロード | 1. コーチアカウントでログイン<br>2. ナレッジベース管理ページにアクセス<br>3. システムRAGカード選択<br>4. ドキュメント一覧確認<br>5. 「ドキュメントをアップロード」ボタンをクリック<br>6. PDFファイルを選択<br>7. アップロード実行 | ・ナレッジベース一覧が表示される<br>・システムRAGカードが選択される<br>・ドキュメント一覧が表示される<br>・アップロードモーダルが表示される<br>・ファイルがアップロードされる<br>・ドキュメント一覧に新規ドキュメントが追加される（status="pending"） | | | |
| 57 | E2E-KB-057 | ワークフロー：ドキュメント削除 | E2E-KB-056 | ワークフロー | 正常系 | 高 | アップロード後にドキュメントを削除 | 1. システムRAGカード選択<br>2. ドキュメント一覧から削除対象を選択<br>3. 「削除」ボタンをクリック<br>4. 削除確認モーダルで「削除」をクリック | ・削除確認モーダルが表示される<br>・削除が実行される<br>・ドキュメント一覧から削除されたドキュメントが消える<br>・ナレッジベースカードのドキュメント数が減少 | | | |
| 58 | E2E-KB-058 | ワークフロー：チャンク設定変更と保存 | E2E-KB-056 | ワークフロー | 正常系 | 中 | チャンク設定を変更して保存 | 1. システムRAGカード選択<br>2. チャンクサイズを500→800に変更<br>3. オーバーラップを50→100に変更<br>4. 「設定を保存」ボタンをクリック | ・スライダーが変化<br>・「設定を保存」ボタンが有効になる<br>・設定が保存される<br>・成功メッセージが表示される<br>・ナレッジベースカードの更新日時が更新される | | | |
| 59 | E2E-KB-059 | ワークフロー：検索精度テスト実行 | E2E-KB-056 | ワークフロー | 正常系 | 中 | 検索精度テストを実行 | 1. システムRAGカード選択<br>2. 検索クエリに「コーチングの傾聴スキルとは」と入力<br>3. Top Kを5に設定<br>4. 「テスト実行」ボタンをクリック<br>5. 検索結果を確認 | ・クエリが入力される<br>・Top Kが設定される<br>・テストが実行される<br>・検索結果が5件表示される<br>・各結果にファイル名、チャンク内容、類似度スコアが表示される | | | |
| 60 | E2E-KB-060 | ワークフロー：ナレッジベース切り替え | E2E-KB-056 | ワークフロー | 正常系 | 中 | システムRAGからユーザーRAGに切り替え | 1. システムRAGカード選択<br>2. ドキュメント一覧確認<br>3. ユーザーRAGカードをクリック<br>4. ドキュメント一覧確認 | ・システムRAGのドキュメント一覧が表示される<br>・ユーザーRAGカードが選択される（青色ボーダー）<br>・システムRAGカードのボーダーが消える<br>・ユーザーRAGのドキュメント一覧が表示される | | | |
| 61 | E2E-KB-061 | ブラウザ互換性：Chrome | E2E-KB-001 | ブラウザ互換性 | 正常系 | 高 | Chrome最新版での動作確認 | 1. Chrome最新版を使用<br>2. ナレッジベース管理ページにアクセス | ・すべての要素が正常に表示される<br>・ナレッジベース一覧、ドキュメントテーブルが正しく動作<br>・アップロード、削除機能が正常 | | | |
| 62 | E2E-KB-062 | ブラウザ互換性：Edge | E2E-KB-001 | ブラウザ互換性 | 正常系 | 中 | Edge最新版での動作確認 | 1. Edge最新版を使用<br>2. ナレッジベース管理ページにアクセス | ・すべての要素が正常に表示される<br>・Chromeと同様の挙動 | | | |
| 63 | E2E-KB-063 | ブラウザ互換性：Firefox | E2E-KB-001 | ブラウザ互換性 | 正常系 | 中 | Firefox最新版での動作確認 | 1. Firefox最新版を使用<br>2. ナレッジベース管理ページにアクセス | ・すべての要素が正常に表示される<br>・ファイルアップロード、削除機能が正常 | | | |
| 64 | E2E-KB-064 | エッジケース：ドキュメント0件のナレッジベース | E2E-KB-007 | エッジケース | 異常系 | 低 | ドキュメントが1件もない場合 | 1. モックデータでドキュメント0件のナレッジベースを作成<br>2. そのナレッジベースカードを選択 | ・ドキュメント一覧に「ドキュメントがありません」表示<br>・「ドキュメントをアップロード」ボタンは有効<br>・チャンク設定は表示される | | | |
| 65 | E2E-KB-065 | エッジケース：ドキュメント100件以上 | E2E-KB-007 | エッジケース | 異常系 | 低 | ドキュメントが100件以上ある場合 | 1. モックデータでドキュメント100件のナレッジベースを作成<br>2. そのナレッジベースカードを選択 | ・ドキュメント一覧が正常に表示される<br>・縦スクロール可能<br>・パフォーマンス問題なし<br>・MVP段階ではページネーションなし（全件表示） | | | |
| 66 | E2E-KB-066 | エッジケース：ファイル名が非常に長い | E2E-KB-022 | エッジケース | 異常系 | 低 | 255文字のファイル名をアップロード | 1. 255文字のファイル名を持つPDFファイルを作成<br>2. アップロードモーダル表示<br>3. ファイルを選択<br>4. アップロード実行 | ・ファイル名が表示される（省略表示または折り返し）<br>・アップロードが成功する<br>・ドキュメント一覧でファイル名が適切に表示される（省略表示または折り返し） | | | |
| 67 | E2E-KB-067 | エッジケース：検索結果0件 | E2E-KB-037 | エッジケース | 異常系 | 低 | 検索クエリに一致する結果がない場合 | 1. 検索精度テストパネル表示<br>2. 検索クエリに「xyzabc12345」と入力（存在しないキーワード）<br>3. テスト実行 | ・検索結果0件<br>・「検索結果がありません」表示<br>・エラーではない（正常動作） | | | |

## テスト分類別カバレッジ
- 正常系: 42項目
- 異常系: 14項目
- セキュリティ: 6項目
- レスポンシブ: 3項目
- ワークフロー: 5項目
- パフォーマンス: 2項目
- エッジケース: 4項目
- ブラウザ互換性: 3項目

## API呼び出し一覧
| No | メソッド | エンドポイント | 用途 | 対応テストID |
|----|---------|--------------|------|-------------|
| 1 | GET | `/v1/datasets` | ナレッジベース一覧取得 | E2E-KB-004, E2E-KB-046 |
| 2 | GET | `/v1/datasets/{dataset_id}/documents` | ドキュメント一覧取得 | E2E-KB-007, E2E-KB-014, E2E-KB-047 |
| 3 | POST | `/v1/datasets/{dataset_id}/documents` | ドキュメントアップロード | E2E-KB-024, E2E-KB-025, E2E-KB-026, E2E-KB-027, E2E-KB-028, E2E-KB-048 |
| 4 | DELETE | `/v1/datasets/{dataset_id}/documents/{document_id}` | ドキュメント削除 | E2E-KB-031, E2E-KB-049 |
| 5 | PUT | `/v1/datasets/{dataset_id}/settings` | チャンク設定更新 | E2E-KB-011, E2E-KB-050 |
| 6 | POST | `/v1/datasets/{dataset_id}/search-test` | 検索精度テスト | E2E-KB-037 |

## 優先度別実施順序

### 1. 高優先度（必須）: 39項目
E2E-KB-001, E2E-KB-002, E2E-KB-003, E2E-KB-004, E2E-KB-005, E2E-KB-006, E2E-KB-007, E2E-KB-008, E2E-KB-009, E2E-KB-010, E2E-KB-011, E2E-KB-014, E2E-KB-015, E2E-KB-016, E2E-KB-017, E2E-KB-018, E2E-KB-019, E2E-KB-020, E2E-KB-021, E2E-KB-022, E2E-KB-023, E2E-KB-024, E2E-KB-025, E2E-KB-026, E2E-KB-027, E2E-KB-028, E2E-KB-030, E2E-KB-031, E2E-KB-033, E2E-KB-046, E2E-KB-047, E2E-KB-048, E2E-KB-049, E2E-KB-050, E2E-KB-051, E2E-KB-052, E2E-KB-053, E2E-KB-056, E2E-KB-057, E2E-KB-061

### 2. 中優先度（推奨）: 20項目
E2E-KB-012, E2E-KB-013, E2E-KB-029, E2E-KB-032, E2E-KB-034, E2E-KB-035, E2E-KB-036, E2E-KB-037, E2E-KB-038, E2E-KB-040, E2E-KB-041, E2E-KB-044, E2E-KB-045, E2E-KB-054, E2E-KB-055, E2E-KB-058, E2E-KB-059, E2E-KB-060, E2E-KB-062, E2E-KB-063

### 3. 低優先度（任意）: 8項目
E2E-KB-039, E2E-KB-042, E2E-KB-043, E2E-KB-064, E2E-KB-065, E2E-KB-066, E2E-KB-067

## 前提条件

### テストアカウント
- コーチ: coach@rag-base.local / TestCoach2025!
- クライアント: client1@rag-base.local / TestClient2025!

### テスト環境
- モックAPIサービス: `mockDatasetService.ts`使用（作成予定）
- ブラウザ: Chrome最新版、Edge最新版、Firefox最新版（PC想定）
- デバイス:
  - デスクトップ: 1920x1080px（推奨）
  - タブレット: 768x1024px（任意）
  - モバイル: 375x667px（MVP段階では対応不要）

### モックデータ

#### ナレッジベース（2件）
```typescript
[
  {
    dataset_id: 'system-rag-001',
    name: 'システムRAG - コーチング理論体系',
    type: 'system',
    total_documents: 15,
    total_chunks: 342,
  },
  {
    dataset_id: 'user-rag-client1',
    name: 'ユーザーRAG_client1',
    type: 'user',
    total_documents: 8,
    total_chunks: 156,
  },
]
```

#### ドキュメント（システムRAG: 3件）
```typescript
[
  {
    document_id: 'doc-001',
    filename: 'コーチング基礎理論.pdf',
    file_type: 'pdf',
    status: 'completed',
    chunk_count: 45,
  },
  {
    document_id: 'doc-002',
    filename: '傾聴スキル実践ガイド.docx',
    file_type: 'docx',
    status: 'processing',
    chunk_count: 0,
  },
  {
    document_id: 'doc-003',
    filename: '質問技法まとめ.txt',
    file_type: 'txt',
    status: 'completed',
    chunk_count: 23,
  },
]
```

## テスト実施時の注意事項

### 1. PC画面テスト（MVP段階の主要ターゲット）
- デスクトップブラウザ（Chrome、Edge、Firefox）で確認
- 1920x1080pxの画面解像度を推奨
- マウス操作とキーボード操作の両方を確認

### 2. ファイルアップロードテスト
- テスト用ファイルを事前に準備（PDF、DOCX、TXT各1件）
- ファイルサイズ: 1MB程度（10MB以下）
- 対応外ファイル（PNG等）も準備

### 3. セキュリティテスト
- クライアントロールでのアクセス制御を重点確認
- ブラウザコンソールでAPI直接アクセスを試行
- トークン期限切れの挙動を確認

### 4. パフォーマンステスト
- Chrome DevToolsのNetworkタブでAPI応答時間を測定
- Lighthouseスコア目標: Performance 90以上

### 5. エラーハンドリングテスト
- Chrome DevToolsでネットワークをオフライン化
- エラーアラートの表示を確認
- コンソールエラーログを確認

## 既知の制限事項（MVP段階）

### 1. ページネーション未実装
- ドキュメント一覧は全件表示
- 100件以上のドキュメントがある場合、パフォーマンス低下の可能性
- 本番化時にページネーション実装予定

### 2. リアルタイム更新なし
- ベクトル化進捗のリアルタイム更新機能なし
- ページリロードで最新データを取得
- WebSocketによるリアルタイム更新は本番化時に実装予定

### 3. バッチアップロード未対応
- 1ファイルずつアップロード
- 複数ファイルの同時アップロード機能なし
- 本番化時にバッチアップロード実装予定

### 4. 再ベクトル化機能なし
- 既存ドキュメントの再ベクトル化機能なし
- チャンク設定変更後は削除→再アップロードが必要
- 本番化時に再ベクトル化API実装予定

## テスト完了基準

### 全体完了基準
- 高優先度テスト: 100%成功（39/39）
- 中優先度テスト: 90%以上成功（18/20以上）
- 低優先度テスト: 80%以上成功（7/8以上）

### デバイス別完了基準
- デスクトップ: すべての高優先度テスト成功
- タブレット: レスポンシブテスト含む中優先度テスト成功
- モバイル: MVP段階ではテスト不要

### セキュリティ完了基準
- E2E-KB-002, E2E-KB-003, E2E-KB-051, E2E-KB-052, E2E-KB-053: すべて成功

### パフォーマンス完了基準
- 初期ロード: 3秒以内
- ナレッジベース一覧取得: 500ms以内（モック300ms）
- ドキュメント一覧取得: 500ms以内（モック）
- Lighthouse Performance: 90以上

### 機能別完了基準
- ナレッジベース一覧表示: E2E-KB-004, E2E-KB-005, E2E-KB-006 成功
- ナレッジベース選択: E2E-KB-007, E2E-KB-008 成功
- チャンク設定: E2E-KB-009, E2E-KB-010, E2E-KB-011 成功
- ドキュメント一覧: E2E-KB-014, E2E-KB-015, E2E-KB-016, E2E-KB-017, E2E-KB-018, E2E-KB-020 成功
- ドキュメントアップロード: E2E-KB-024, E2E-KB-025, E2E-KB-026 成功
- ドキュメント削除: E2E-KB-031 成功
- 検索精度テスト: E2E-KB-037 成功（中優先度）

## 参考資料
- 要件定義書: `docs/requirements.md` - D-005仕様
- API仕様書: `docs/api-specs/knowledge-base-api.md`
- 型定義: `frontend/src/types/index.ts`
- プロジェクト設定: `CLAUDE.md`

---

**作成日**: 2025-11-02
**バージョン**: MVP v1.0
**次回更新予定**: テスト実施完了後
