# WorkflowEditorPage（D-008）E2Eテスト仕様書

生成日: 2025-11-02
対象ページ: /admin/workflow
テスト環境: モック実装
作成者: E2Eテスト仕様書作成エージェント

## 概要
- 総テスト項目数: 62
- 高優先度: 36項目
- 中優先度: 18項目
- 低優先度: 8項目

## テスト項目一覧

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 1 | E2E-WORKFLOW-001 | ページアクセス（コーチロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | コーチロールでのワークフロー編集ページアクセス | 1. コーチアカウントでログイン（coach@rag-base.local）<br>2. `/admin/workflow`にアクセス | ・ワークフロー編集ページが表示される<br>・ページタイトル「ワークフロー編集」表示<br>・説明文「AIコーチングbotのワークフロー（処理フロー）を可視化・編集できます。」表示<br>・左側にノードパレット表示<br>・中央にキャンバス表示<br>・右側にテストパネル表示 | | | |
| 2 | E2E-WORKFLOW-002 | ページアクセス（クライアントロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | クライアントロールのアクセス拒否 | 1. クライアントアカウントでログイン（client1@rag-base.local）<br>2. `/admin/workflow`に直接アクセス | ・403 Forbiddenエラー表示<br>・または、クライアント向けチャットページ（/chat）にリダイレクト<br>・エラーメッセージ「管理者権限が必要です」表示 | | | |
| 3 | E2E-WORKFLOW-003 | ページアクセス（未認証） | なし | 認証・アクセス制御 | セキュリティ | 高 | 未ログイン時のアクセス制御 | 1. ログアウト状態<br>2. `/admin/workflow`に直接アクセス | ・ログインページにリダイレクト<br>・エラーメッセージ表示（要ログイン） | | | |
| 4 | E2E-WORKFLOW-004 | ワークフローデータ取得（成功） | E2E-WORKFLOW-001 | データ取得 | 正常系 | 高 | API呼び出しとワークフロー表示 | 1. コーチアカウントでログイン<br>2. ワークフロー編集ページにアクセス<br>3. ネットワークタブでAPIリクエスト確認 | ・`GET /admin/app/{appId}/workflow`が実行される<br>・ローディング表示が出る（800ms）<br>・ワークフローが正常に表示される<br>・8ノード表示（開始、危機検出、システムRAG、ユーザーRAG、プロンプト生成、LLM呼び出し、コーチ通知、終了）<br>・7本の接続線表示<br>・エラーなし | | | |
| 5 | E2E-WORKFLOW-005 | ノード一覧表示 | E2E-WORKFLOW-004 | ワークフロー表示 | 正常系 | 高 | キャンバスに8ノード表示 | 1. ワークフロー編集ページ表示<br>2. キャンバス内のノードを確認 | ・8ノードが表示される<br>・各ノードにアイコン表示<br>・各 ノードに名称表示<br>・ノードが横一列に配置（通常ルート）<br>・コーチ通知ノードは下方に配置（危機ルート） | | | |
| 6 | E2E-WORKFLOW-006 | 接続線表示（通常ルート） | E2E-WORKFLOW-004 | ワークフロー表示 | 正常系 | 高 | 通常ルートの接続線（青色実線） | 1. ワークフロー編集ページ表示<br>2. 接続線を確認 | ・開始 → 危機検出 → システムRAG → ユーザーRAG → プロンプト生成 → LLM呼び出し → 終了<br>・接続線が青色の実線（stroke: #3b82f6, strokeWidth: 2）<br>・矢印マーカー表示<br>・ノード間の距離が適切（180-200px） | | | |
| 7 | E2E-WORKFLOW-007 | 接続線表示（危機ルート） | E2E-WORKFLOW-004 | ワークフロー表示 | 正常系 | 高 | 危機ルートの接続線（赤色点線） | 1. ワークフロー編集ページ表示<br>2. 危機ルートの接続線を確認 | ・危機検出 → コーチ通知<br>・接続線が赤色の点線（stroke: #ef4444, strokeWidth: 2, strokeDasharray: 5 5）<br>・条件付き接続（crisis_detected === true）<br>・矢印マーカー表示 | | | |
| 8 | E2E-WORKFLOW-008 | ノード選択：危機検出ノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | ノードクリックで選択状態に変化 | 1. ワークフロー編集ページ表示<br>2. 危機検出ノードをクリック | ・ノードがハイライト表示（青色ボーダー）<br>・右側パネルにノード設定表示<br>・ノード名「危機検出（キーワードベース）」表示<br>・ノードタイプ「crisis_detection」表示<br>・設定内容表示（キーワードリスト、検出方法、出力変数） | | | |
| 9 | E2E-WORKFLOW-009 | 危機検出ノード設定内容確認 | E2E-WORKFLOW-008 | ノード設定表示 | 正常系 | 高 | 危機検出ノードの詳細設定 | 1. 危機検出ノードを選択<br>2. 右側パネルの設定内容を確認 | ・**キーワードリスト**: 「死にたい」「消えたい」「辛い」「苦しい」「助けて」<br>・**検出方法**: keyword_match<br>・**出力変数**: crisis_detected<br>・各項目が読み取り専用（MVP段階では編集不可）<br>・テキストで表示（リストはカンマ区切り） | | | |
| 10 | E2E-WORKFLOW-010 | ノード選択：システムRAG取得ノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | システムRAG取得ノードの設定表示 | 1. ワークフロー編集ページ表示<br>2. システムRAG取得ノードをクリック | ・ノードがハイライト表示<br>・右側パネルにノード設定表示<br>・ノード名「システムRAG取得」表示<br>・ノードタイプ「rag_retrieval」表示<br>・**データセットタイプ**: system<br>・**データセットID**: system-coaching-theory<br>・**クエリ変数**: user_message<br>・**Top K**: 5<br>・**出力変数**: system_knowledge | | | |
| 11 | E2E-WORKFLOW-011 | ノード選択：ユーザーRAG取得ノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | ユーザーRAG取得ノードの設定表示 | 1. ワークフロー編集ページ表示<br>2. ユーザーRAG取得ノードをクリック | ・ノードがハイライト表示<br>・右側パネルにノード設定表示<br>・ノード名「ユーザーRAG取得」表示<br>・ノードタイプ「rag_retrieval」表示<br>・**データセットタイプ**: user<br>・**データセットID**: user-{user_id}<br>・**クエリ変数**: user_message<br>・**Top K**: 3<br>・**出力変数**: user_history | | | |
| 12 | E2E-WORKFLOW-012 | ノード選択：プロンプト生成ノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | プロンプト生成ノードの設定表示 | 1. ワークフロー編集ページ表示<br>2. プロンプト生成ノードをクリック | ・ノードがハイライト表示<br>・右側パネルにノード設定表示<br>・ノード名「プロンプト生成」表示<br>・ノードタイプ「prompt_generation」表示<br>・**テンプレート**: システムRAG: {{system_knowledge}}...<br>・**入力変数**: system_knowledge, user_history, user_message<br>・**出力変数**: final_prompt | | | |
| 13 | E2E-WORKFLOW-013 | ノード選択：LLM呼び出しノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | LLM呼び出しノードの設定表示 | 1. ワークフロー編集ページ表示<br>2. LLM呼び出しノードをクリック | ・ノードがハイライト表示<br>・右側パネルにノード設定表示<br>・ノード名「LLM呼び出し（Claude）」表示<br>・ノードタイプ「llm_call」表示<br>・**モデル**: claude-3-5-haiku-20241022<br>・**プロンプト変数**: final_prompt<br>・**temperature**: 0.7<br>・**max_tokens**: 1000<br>・**出力変数**: ai_response | | | |
| 14 | E2E-WORKFLOW-014 | ノード選択：コーチ通知ノード | E2E-WORKFLOW-004 | ノード操作 | 正常系 | 高 | コーチ通知ノードの設定表示 | 1. ワークフロー編集ページ表示<br>2. コーチ通知ノードをクリック | ・ノードがハイライト表示<br>・右側パネルにノード設定表示<br>・ノード名「コーチ通知」表示<br>・ノードタイプ「coach_alert」表示<br>・**アラートタイプ**: crisis<br>・**メッセージテンプレート**: クライアント{{user_name}}から危機フラグが検出されました...<br>・**条件変数**: crisis_detected<br>・**通知チャネル**: email, slack | | | |
| 15 | E2E-WORKFLOW-015 | テストパネル：初期状態 | E2E-WORKFLOW-004 | テストパネル | 正常系 | 高 | テストパネルの初期表示 | 1. ワークフロー編集ページ表示<br>2. 右側のテストパネルを確認 | ・パネルタイトル「ワークフロー実行テスト」表示<br>・テスト入力欄（TextField）表示<br>・プレースホルダー「テスト入力メッセージを入力...」<br>・「実行」ボタン表示（青色、無効状態）<br>・結果表示エリア非表示 | | | |
| 16 | E2E-WORKFLOW-016 | テストパネル：入力エリア編集 | E2E-WORKFLOW-015 | テストパネル | 正常系 | 高 | テスト入力メッセージの編集 | 1. ワークフロー編集ページ表示<br>2. テスト入力欄にテキスト入力 | ・入力した文字が表示される<br>・「実行」ボタンが有効化される（青色に変化）<br>・文字数制限なし（長文入力可能）<br>・複数行入力可能（multiline） | | | |
| 17 | E2E-WORKFLOW-017 | テストパネル：ワークフロー実行（通常ルート） | E2E-WORKFLOW-016 | ワークフロー実行 | 正常系 | 高 | 通常ルートのワークフロー実行 | 1. ワークフロー編集ページ表示<br>2. テスト入力欄に「最近、仕事のストレスで夜も眠れません。何か良い方法はありますか？」を入力<br>3. 「実行」ボタンをクリック | ・`POST /admin/app/{appId}/workflow/test`が実行される<br>・ローディング表示（2秒）<br>・実行結果が表示される<br>・**総実行時間**: 約3245ms<br>・**実行ログ**: 8ノード分（7件success、1件skipped）<br>・**最終出力**: AI応答テキスト表示<br>・エラーなし | | | |
| 18 | E2E-WORKFLOW-018 | テストパネル：実行ログ表示（8ノード分） | E2E-WORKFLOW-017 | ワークフロー実行 | 正常系 | 高 | 8ノードの実行ログ確認 | 1. ワークフロー実行完了後<br>2. 実行ログを確認 | ・**ノード1（開始ノード）**: status=success, 実行時間=5ms<br>・**ノード2（危機検出）**: status=success, crisis_detected=false, 実行時間=12ms<br>・**ノード3（システムRAG）**: status=success, retrieved_count=5, 実行時間=450ms<br>・**ノード4（ユーザーRAG）**: status=success, retrieved_count=3, 実行時間=320ms<br>・**ノード5（プロンプト生成）**: status=success, 実行時間=8ms<br>・**ノード6（LLM呼び出し）**: status=success, tokens_used=245, 実行時間=2400ms<br>・**ノード7（終了ノード）**: status=success, 実行時間=2ms<br>・**ノード8（コーチ通知）**: status=skipped, skip_reason=「条件が満たされませんでした」 | | | |
| 19 | E2E-WORKFLOW-019 | テストパネル：総実行時間表示 | E2E-WORKFLOW-017 | ワークフロー実行 | 正常系 | 高 | 総実行時間の表示確認 | 1. ワークフロー実行完了後<br>2. 総実行時間を確認 | ・実行結果パネルの上部に「実行時間: 3.245秒」と表示<br>・ミリ秒を秒に変換（小数点3桁まで表示）<br>・背景色: 水色（info） | | | |
| 20 | E2E-WORKFLOW-020 | テストパネル：危機キーワード検出 | E2E-WORKFLOW-016 | ワークフロー実行 | 正常系 | 高 | 危機キーワード含む入力のテスト実行 | 1. ワークフロー編集ページ表示<br>2. テスト入力欄に「もう死にたいです。消えてしまいたい。」を入力<br>3. 「実行」ボタンをクリック | ・ワークフロー実行成功<br>・**危機検出ノード**: crisis_detected=true, matched_keywords=["死にたい", "消えてしまいたい"]<br>・**コーチ通知ノード**: status=success, alert_sent=true, notification_channels=["email", "slack"]<br>・実行ログに危機ルートが記録される | | | |
| 21 | E2E-WORKFLOW-021 | テストパネル：最終出力表示 | E2E-WORKFLOW-017 | ワークフロー実行 | 正常系 | 高 | AI応答テキストの表示 | 1. ワークフロー実行完了後<br>2. 最終出力セクションを確認 | ・最終出力セクションに「最終出力」というラベル表示<br>・AI応答テキストが全文表示される<br>・テキストが読みやすく整形される（改行保持）<br>・長文の場合はスクロール可能 | | | |
| 22 | E2E-WORKFLOW-022 | テストパネル：ログ展開/折りたたみ | E2E-WORKFLOW-017 | テストパネル | 正常系 | 中 | 各ノードのログ詳細表示 | 1. ワークフロー実行完了後<br>2. ログリストの各ノードをクリック | ・各ノードログがAccordionで展開/折りたたみ可能<br>・デフォルトは折りたたみ状態<br>・展開時に入力データ・出力データ・実行時間が表示される<br>・JSON形式で整形表示（見やすく） | | | |
| 23 | E2E-WORKFLOW-023 | ノードパレット：6カテゴリ表示 | E2E-WORKFLOW-004 | ノードパレット | 正常系 | 中 | ノードパレットのカテゴリ一覧 | 1. ワークフロー編集ページ表示<br>2. 左側のノードパレットを確認 | ・6カテゴリが表示される<br>・**開始/終了**: 開始ノード、終了ノード<br>・**データ取得**: RAG取得ノード<br>・**AI処理**: LLM呼び出しノード、プロンプト生成ノード<br>・**条件分岐**: 危機検出ノード<br>・**通知**: コーチ通知ノード<br>・**その他**: カスタムノード<br>・各カテゴリが折りたたみ可能（Accordion） | | | |
| 24 | E2E-WORKFLOW-024 | ノードパレット：ノード情報表示 | E2E-WORKFLOW-023 | ノードパレット | 正常系 | 中 | 各ノードの名称とアイコン | 1. ワークフロー編集ページ表示<br>2. ノードパレット内の各ノードを確認 | ・各ノードにアイコンが表示される<br>・各ノードに名称が表示される<br>・ホバー時にツールチップで説明表示<br>・ドラッグ可能（MVP段階では未実装、表示のみ） | | | |
| 25 | E2E-WORKFLOW-025 | キャンバス：SVG座標系 | E2E-WORKFLOW-004 | キャンバス表示 | 正常系 | 中 | SVGキャンバスの座標系確認 | 1. ワークフロー編集ページ表示<br>2. ブラウザ開発者ツールでSVG要素を確認 | ・SVG要素が正しく描画される<br>・viewBox設定が適切<br>・ノード位置がposition.x, position.yに基づいて配置される<br>・接続線がノード間を正確に結ぶ | | | |
| 26 | E2E-WORKFLOW-026 | キャンバス：ノードアイコン表示 | E2E-WORKFLOW-004 | キャンバス表示 | 正常系 | 中 | 各ノードのアイコン確認 | 1. ワークフロー編集ページ表示<br>2. 各ノードのアイコンを確認 | ・開始ノード: PlayArrowIcon（再生アイコン）<br>・危機検出ノード: WarningIcon（警告アイコン）<br>・システムRAG/ユーザーRAG: StorageIcon（ストレージアイコン）<br>・プロンプト生成: EditIcon（編集アイコン）<br>・LLM呼び出し: SmartToyIcon（AIアイコン）<br>・コーチ通知: NotificationsIcon（通知アイコン）<br>・終了ノード: CheckCircleIcon（チェックアイコン） | | | |
| 27 | E2E-WORKFLOW-027 | 保存ボタン（未実装） | E2E-WORKFLOW-004 | ボタン操作 | 正常系 | 中 | 保存ボタンクリック時のアラート | 1. ワークフロー編集ページ表示<br>2. 画面上部の「保存」ボタンをクリック | ・ブラウザアラート表示<br>・メッセージ「ワークフロー保存機能は現在開発中です。近日中に実装予定です。」<br>・ワークフローは保存されない | | | |
| 28 | E2E-WORKFLOW-028 | 元に戻すボタン（未実装） | E2E-WORKFLOW-004 | ボタン操作 | 正常系 | 中 | 元に戻すボタンクリック時のアラート | 1. ワークフロー編集ページ表示<br>2. 画面上部の「元に戻す」ボタンをクリック | ・ブラウザアラート表示<br>・メッセージ「元に戻す機能は現在開発中です。近日中に実装予定です。」<br>・変更は取り消されない | | | |
| 29 | E2E-WORKFLOW-029 | API接続エラー（ワークフロー取得） | E2E-WORKFLOW-001 | エラーハンドリング | 異常系 | 高 | ワークフロー取得時のAPI接続エラー | 1. ネットワークを切断<br>2. ワークフロー編集ページにアクセス | ・エラーアラート表示（MUI Alert、severity="error"）<br>・メッセージ「ワークフローの取得に失敗しました」<br>・キャンバスが空の状態<br>・コンソールにエラーログ出力 | | | |
| 30 | E2E-WORKFLOW-030 | API接続エラー（ワークフロー実行テスト） | E2E-WORKFLOW-016 | エラーハンドリング | 異常系 | 高 | ワークフロー実行テスト時のAPI接続エラー | 1. テスト入力欄にテキスト入力<br>2. ネットワークを切断<br>3. 「実行」ボタンをクリック | ・エラーアラート表示（MUI Alert、severity="error"）<br>・メッセージ「ワークフロー実行に失敗しました」<br>・実行ログ非表示<br>・コンソールにエラーログ出力 | | | |
| 31 | E2E-WORKFLOW-031 | ワークフロー実行エラー（ノードエラー） | E2E-WORKFLOW-016 | エラーハンドリング | 異常系 | 高 | ノード実行中のエラー | 1. モックサービスでLLM呼び出しノードのエラーをシミュレート<br>2. テスト入力してワークフロー実行 | ・実行結果にエラー表示<br>・エラーノードのログに「status: error」<br>・エラー詳細表示（例: Claude API接続タイムアウト）<br>・以降のノードはスキップされる | | | |
| 32 | E2E-WORKFLOW-032 | テスト入力が空の場合 | E2E-WORKFLOW-015 | エラーハンドリング | 異常系 | 中 | 空入力での実行防止 | 1. ワークフロー編集ページ表示<br>2. テスト入力欄を空のまま「実行」ボタンをクリック | ・「実行」ボタンが無効状態（クリック不可）<br>・またはエラーメッセージ「テスト入力を入力してください」表示 | | | |
| 33 | E2E-WORKFLOW-033 | セキュリティ：他ロールのアクセス試行 | E2E-WORKFLOW-002 | セキュリティ | セキュリティ | 高 | クライアントロールでの不正アクセス防止 | 1. クライアントアカウントでログイン<br>2. URLを直接入力して`/admin/workflow`にアクセス<br>3. ブラウザ開発者ツールでリクエスト確認 | ・403 Forbiddenエラー<br>・または、/chatにリダイレクト<br>・APIリクエストは送信されない（フロントエンド側で制御）<br>・または、APIが403を返す（バックエンド側で制御） | | | |
| 34 | E2E-WORKFLOW-034 | セキュリティ：APIエンドポイントの直接アクセス | E2E-WORKFLOW-001 | セキュリティ | セキュリティ | 高 | クライアントロールによるAPI直接アクセス防止 | 1. クライアントアカウントでログイン<br>2. ブラウザコンソールで`fetch('/admin/app/{appId}/workflow')`を実行 | ・403 Forbiddenエラー<br>・エラーレスポンス:<br>　{<br>　　"error": "forbidden",<br>　　"message": "コーチロールのみアクセス可能です",<br>　　"status": 403<br>　} | | | |
| 35 | E2E-WORKFLOW-035 | セキュリティ：トークン期限切れ | E2E-WORKFLOW-001 | セキュリティ | セキュリティ | 高 | トークン期限切れ時の挙動 | 1. コーチアカウントでログイン<br>2. トークン有効期限を過ぎた状態をシミュレート（localStorageのトークンを削除）<br>3. ワークフロー編集ページにアクセス | ・401 Unauthorizedエラー<br>・ログインページにリダイレクト<br>・エラーメッセージ「セッションが期限切れです。再度ログインしてください。」 | | | |
| 36 | E2E-WORKFLOW-036 | レスポンシブ：デスクトップ（1920px） | E2E-WORKFLOW-001 | レスポンシブ | 正常系 | 高 | デスクトップ大画面での表示 | 1. ブラウザ幅1920pxに設定<br>2. ワークフロー編集ページ表示 | ・左側パネル（ノードパレット）: 幅250px<br>・中央キャンバス: 残りの幅の60%<br>・右側パネル（テストパネル）: 残りの幅の40%<br>・3列レイアウトが適切に表示<br>・キャンバスが広く、すべてのノードが見える | | | |
| 37 | E2E-WORKFLOW-037 | レスポンシブ：デスクトップ（1366px） | E2E-WORKFLOW-001 | レスポンシブ | 正常系 | 高 | 小さめデスクトップ画面での表示 | 1. ブラウザ幅1366pxに設定<br>2. ワークフロー編集ページ表示 | ・3列レイアウトが維持される<br>・キャンバスが狭くなるが、すべてのノードが表示される<br>・テストパネルの幅が調整される<br>・横スクロールなし | | | |
| 38 | E2E-WORKFLOW-038 | レスポンシブ：タブレット（768px）未対応 | E2E-WORKFLOW-001 | レスポンシブ | 異常系 | 低 | タブレット画面での表示（MVP段階ではPC専用） | 1. ブラウザ幅768pxに設定<br>2. ワークフロー編集ページ表示 | ・レイアウトが崩れる可能性あり（MVP段階ではPC専用のため許容）<br>・または、エラーメッセージ「この機能はPC専用です」表示<br>・本番化時にレスポンシブ対応予定 | | | |
| 39 | E2E-WORKFLOW-039 | パフォーマンス：初期ロード時間 | E2E-WORKFLOW-001 | パフォーマンス | 正常系 | 中 | ページ初期ロード速度 | 1. ページロード時のパフォーマンスを測定 | ・ページが3秒以内に表示される<br>・ワークフロー取得API完了まで1秒以内（モック800ms遅延）<br>・First Contentful Paint < 1.5秒<br>・Time to Interactive < 3秒 | | | |
| 40 | E2E-WORKFLOW-040 | パフォーマンス：ワークフロー実行テスト時間 | E2E-WORKFLOW-017 | パフォーマンス | 正常系 | 中 | ワークフロー実行テスト応答時間 | 1. テスト入力してワークフロー実行<br>2. ネットワークタブでAPI応答時間を測定 | ・APIレスポンスが3-5秒以内（モック2000ms遅延）<br>・本番環境では3-5秒を目標（LLM呼び出し含む）<br>・総実行時間がUI上に表示される | | | |
| 41 | E2E-WORKFLOW-041 | パフォーマンス：大規模ワークフロー（20ノード） | E2E-WORKFLOW-004 | パフォーマンス | 異常系 | 低 | 多数のノードでの表示パフォーマンス | 1. モックデータを20ノードに変更<br>2. ワークフロー編集ページ表示 | ・すべてのノードが表示される<br>・接続線が正しく描画される<br>・初期ロードが5秒以内<br>・UI操作が重くならない | | | |
| 42 | E2E-WORKFLOW-042 | アクセシビリティ：キーボードナビゲーション | E2E-WORKFLOW-001 | アクセシビリティ | 正常系 | 低 | キーボードのみでの操作 | 1. マウスを使用せずTabキーで移動<br>2. 各要素にフォーカス | ・Tabキーでボタン、ノード、入力欄間を移動可能<br>・フォーカス表示が明確<br>・Enterキーでボタンをクリック可能<br>・テスト入力欄がキーボードで編集可能 | | | |
| 43 | E2E-WORKFLOW-043 | アクセシビリティ：スクリーンリーダー対応 | E2E-WORKFLOW-001 | アクセシビリティ | 正常系 | 低 | スクリーンリーダーでの読み上げ | 1. スクリーンリーダー（VoiceOver/NVDA）を有効化<br>2. ワークフロー編集ページを操作 | ・各ノードの名称と役割が読み上げられる<br>・ボタンの役割が明確<br>・テスト入力欄のラベルが読み上げられる<br>・実行結果が読み上げられる | | | |
| 44 | E2E-WORKFLOW-044 | エッジケース：空のワークフロー | E2E-WORKFLOW-004 | エッジケース | 異常系 | 低 | ノードが0件の場合 | 1. モックデータを空配列に変更<br>2. ワークフロー編集ページ表示 | ・キャンバスが空の状態で表示<br>・エラーなし<br>・「ワークフローが空です」というメッセージ表示（オプション）<br>・ノードパレットは表示される | | | |
| 45 | E2E-WORKFLOW-045 | エッジケース：長いテスト入力（1000文字） | E2E-WORKFLOW-016 | エッジケース | 異常系 | 低 | 非常に長いテスト入力 | 1. テスト入力欄に1000文字のテキストを入力<br>2. ワークフロー実行 | ・入力欄がスクロール可能<br>・ワークフロー実行成功<br>・API応答時間が若干長くなる可能性<br>・UIレイアウト崩れなし | | | |
| 46 | E2E-WORKFLOW-046 | エッジケース：ワークフロー実行時間が10秒以上 | E2E-WORKFLOW-017 | エッジケース | 異常系 | 低 | 長時間実行のシミュレーション | 1. モックの遅延時間を10000msに変更<br>2. テスト入力してワークフロー実行 | ・10秒間ローディング表示<br>・10秒後に実行結果表示<br>・タイムアウトエラーなし<br>・ユーザーは待機可能 | | | |
| 47 | E2E-WORKFLOW-047 | ワークフロー：通常ルートの全ノード実行 | なし | ワークフロー | 正常系 | 高 | 通常メッセージでのワークフロー実行 | 1. コーチアカウントでログイン<br>2. ワークフロー編集ページにアクセス<br>3. テスト入力「最近、仕事のストレスで夜も眠れません。」を入力<br>4. 「実行」ボタンをクリック | ・7ノード（開始、危機検出、システムRAG、ユーザーRAG、プロンプト生成、LLM呼び出し、終了）が実行される<br>・コーチ通知ノードはスキップされる<br>・危機検出ノードでcrisis_detected=false<br>・最終出力にAI応答が表示される | | | |
| 48 | E2E-WORKFLOW-048 | ワークフロー：危機ルートの実行 | なし | ワークフロー | 正常系 | 高 | 危機キーワード含むメッセージでのワークフロー実行 | 1. コーチアカウントでログイン<br>2. ワークフロー編集ページにアクセス<br>3. テスト入力「もう死にたいです。」を入力<br>4. 「実行」ボタンをクリック | ・8ノードすべてが実行される<br>・危機検出ノードでcrisis_detected=true<br>・コーチ通知ノードが実行される（status=success）<br>・コーチ通知ノードのログに「alert_sent: true」<br>・通常ルートも並行して実行される<br>・最終出力にAI応答が表示される | | | |
| 49 | E2E-WORKFLOW-049 | ワークフロー：RAG取得の結果確認 | E2E-WORKFLOW-017 | ワークフロー | 正常系 | 中 | システムRAGとユーザーRAGの取得結果 | 1. テスト入力してワークフロー実行<br>2. システムRAG取得ノードのログを展開<br>3. ユーザーRAG取得ノードのログを展開 | ・システムRAG取得ノード: retrieved_count=5、各チャンクにscoreが付与される<br>・ユーザーRAG取得ノード: retrieved_count=3、各チャンクにscoreが付与される<br>・取得されたチャンクが表示される（テキストとスコア） | | | |
| 50 | E2E-WORKFLOW-050 | ワークフロー：LLM呼び出しの結果確認 | E2E-WORKFLOW-017 | ワークフロー | 正常系 | 中 | LLM呼び出しノードのトークン使用量確認 | 1. テスト入力してワークフロー実行<br>2. LLM呼び出しノードのログを展開 | ・LLM呼び出しノード: tokens_used=245（例）<br>・ai_response（AI応答テキスト）が表示される<br>・実行時間が2-3秒程度（LLM呼び出しが最も時間がかかる） | | | |
| 51 | E2E-WORKFLOW-051 | ブラウザ互換性：Chrome | E2E-WORKFLOW-001 | ブラウザ互換性 | 正常系 | 高 | Chrome最新版での動作確認 | 1. Chrome最新版を使用<br>2. ワークフロー編集ページにアクセス | ・すべての要素が正常に表示される<br>・SVGキャンバスが正しく描画される<br>・ノード選択、ワークフロー実行が正常<br>・ホバー効果が正常 | | | |
| 52 | E2E-WORKFLOW-052 | ブラウザ互換性：Edge | E2E-WORKFLOW-001 | ブラウザ互換性 | 正常系 | 中 | Edge最新版での動作確認 | 1. Edge最新版を使用<br>2. ワークフロー編集ページにアクセス | ・すべての要素が正常に表示される<br>・SVGキャンバスが正しく描画される<br>・Chromeと同様の挙動 | | | |
| 53 | E2E-WORKFLOW-053 | ブラウザ互換性：Firefox | E2E-WORKFLOW-001 | ブラウザ互換性 | 正常系 | 中 | Firefox最新版での動作確認 | 1. Firefox最新版を使用<br>2. ワークフロー編集ページにアクセス | ・すべての要素が正常に表示される<br>・SVGキャンバスが正しく描画される<br>・ノード選択、ワークフロー実行が正常 | | | |
| 54 | E2E-WORKFLOW-054 | ノード選択解除 | E2E-WORKFLOW-008 | ノード操作 | 正常系 | 中 | ノード選択後にキャンバス空白部分をクリック | 1. ノードを選択<br>2. キャンバスの空白部分をクリック | ・ノードのハイライトが解除される<br>・右側パネルが初期状態に戻る（または「ノードを選択してください」メッセージ表示） | | | |
| 55 | E2E-WORKFLOW-055 | 複数ノード選択（未実装） | E2E-WORKFLOW-008 | ノード操作 | 正常系 | 低 | Ctrlキー押しながら複数ノードクリック | 1. ノード1をクリック<br>2. Ctrlキーを押しながらノード2をクリック | ・MVP段階では複数選択未実装<br>・ノード2が選択され、ノード1の選択が解除される<br>・本番化時に複数選択機能を実装予定 | | | |
| 56 | E2E-WORKFLOW-056 | テストパネル：複数回実行 | E2E-WORKFLOW-017 | テストパネル | 正常系 | 中 | 同じ入力で複数回ワークフロー実行 | 1. テスト入力してワークフロー実行<br>2. 同じ入力で再度実行 | ・2回目の実行も正常に完了<br>・実行結果が更新される（前回の結果は上書き）<br>・実行時間が若干異なる可能性 | | | |
| 57 | E2E-WORKFLOW-057 | テストパネル：異なる入力で連続実行 | E2E-WORKFLOW-017 | テストパネル | 正常系 | 中 | 異なる入力で連続してワークフロー実行 | 1. テスト入力1「ストレスがあります」を実行<br>2. テスト入力2「もう死にたいです」を実行 | ・1回目: 通常ルート実行、コーチ通知スキップ<br>・2回目: 危機ルート実行、コーチ通知実行<br>・各実行結果が正しく表示される | | | |
| 58 | E2E-WORKFLOW-058 | ローディング状態（ワークフロー取得） | E2E-WORKFLOW-001 | データ取得 | 正常系 | 中 | ワークフロー取得中のローディング表示 | 1. ワークフロー編集ページにアクセス<br>2. APIレスポンス前の状態を確認 | ・ローディング状態表示<br>・「読み込み中...」テキスト表示<br>・キャンバスが空の状態<br>・中央揃えで表示<br>・最小高さ400px | | | |
| 59 | E2E-WORKFLOW-059 | ローディング状態（ワークフロー実行） | E2E-WORKFLOW-017 | ワークフロー実行 | 正常系 | 中 | ワークフロー実行中のローディング表示 | 1. テスト入力してワークフロー実行<br>2. 実行中の状態を確認 | ・「実行中...」ローディング表示<br>・実行ボタンが無効化される<br>・実行結果エリアが非表示<br>・2秒後（モック）に結果表示 | | | |
| 60 | E2E-WORKFLOW-060 | ノード位置関係の正確性 | E2E-WORKFLOW-004 | キャンバス表示 | 正常系 | 中 | ノード間の距離とレイアウト | 1. ワークフロー編集ページ表示<br>2. ノード間の距離を目視確認 | ・開始ノード（x=100）から危機検出ノード（x=300）: 距離200px<br>・危機検出ノード（x=300）からシステムRAG（x=500）: 距離200px<br>・以降、200px間隔で横一列に配置<br>・コーチ通知ノードは下方（y=400）に配置 | | | |
| 61 | E2E-WORKFLOW-061 | エラーハンドリング：404エラー | E2E-WORKFLOW-001 | エラーハンドリング | 異常系 | 中 | 存在しないアプリIDでのアクセス | 1. URLを直接編集して存在しないアプリIDを指定<br>2. ワークフロー編集ページにアクセス | ・404 Not Foundエラー<br>・エラーアラート表示<br>・メッセージ「指定されたアプリのワークフローが見つかりません」<br>・キャンバスが空の状態 | | | |
| 62 | E2E-WORKFLOW-062 | 全機能統合テスト | なし | 統合テスト | 正常系 | 高 | ワークフロー編集ページの全機能確認 | 1. コーチアカウントでログイン<br>2. ワークフロー編集ページにアクセス<br>3. ワークフロー表示確認（8ノード、7エッジ）<br>4. ノード選択と設定表示確認<br>5. 通常メッセージでテスト実行<br>6. 危機メッセージでテスト実行<br>7. 実行ログ確認 | ・すべての機能が正常に動作<br>・通常ルートと危機ルートの両方が正しく実行される<br>・8ノードの設定が正しく表示される<br>・実行結果が正しく表示される<br>・エラーなし | | | |

## テスト分類別カバレッジ
- 正常系: 40項目
- 異常系: 10項目
- セキュリティ: 6項目
- レスポンシブ: 3項目
- ワークフロー: 4項目
- パフォーマンス: 3項目
- アクセシビリティ: 2項目
- エッジケース: 4項目
- ブラウザ互換性: 3項目
- 統合テスト: 1項目

## API呼び出し一覧
| No | メソッド | エンドポイント | 用途 | 対応テストID |
|----|---------|--------------|------|-------------|
| 1 | GET | `/admin/app/{appId}/workflow` | ワークフロー取得 | E2E-WORKFLOW-004, E2E-WORKFLOW-029, E2E-WORKFLOW-058 |
| 2 | POST | `/admin/app/{appId}/workflow/test` | ワークフロー実行テスト | E2E-WORKFLOW-017, E2E-WORKFLOW-020, E2E-WORKFLOW-030, E2E-WORKFLOW-040 |

## 優先度別実施順序

### 1. 高優先度（必須）: 36項目
E2E-WORKFLOW-001, E2E-WORKFLOW-002, E2E-WORKFLOW-003, E2E-WORKFLOW-004, E2E-WORKFLOW-005, E2E-WORKFLOW-006, E2E-WORKFLOW-007, E2E-WORKFLOW-008, E2E-WORKFLOW-009, E2E-WORKFLOW-010, E2E-WORKFLOW-011, E2E-WORKFLOW-012, E2E-WORKFLOW-013, E2E-WORKFLOW-014, E2E-WORKFLOW-015, E2E-WORKFLOW-016, E2E-WORKFLOW-017, E2E-WORKFLOW-018, E2E-WORKFLOW-019, E2E-WORKFLOW-020, E2E-WORKFLOW-021, E2E-WORKFLOW-029, E2E-WORKFLOW-030, E2E-WORKFLOW-031, E2E-WORKFLOW-033, E2E-WORKFLOW-034, E2E-WORKFLOW-035, E2E-WORKFLOW-036, E2E-WORKFLOW-037, E2E-WORKFLOW-047, E2E-WORKFLOW-048, E2E-WORKFLOW-051, E2E-WORKFLOW-062

### 2. 中優先度（推奨）: 18項目
E2E-WORKFLOW-022, E2E-WORKFLOW-023, E2E-WORKFLOW-024, E2E-WORKFLOW-025, E2E-WORKFLOW-026, E2E-WORKFLOW-027, E2E-WORKFLOW-028, E2E-WORKFLOW-032, E2E-WORKFLOW-039, E2E-WORKFLOW-040, E2E-WORKFLOW-049, E2E-WORKFLOW-050, E2E-WORKFLOW-052, E2E-WORKFLOW-053, E2E-WORKFLOW-054, E2E-WORKFLOW-056, E2E-WORKFLOW-057, E2E-WORKFLOW-058, E2E-WORKFLOW-059, E2E-WORKFLOW-060, E2E-WORKFLOW-061

### 3. 低優先度（任意）: 8項目
E2E-WORKFLOW-038, E2E-WORKFLOW-041, E2E-WORKFLOW-042, E2E-WORKFLOW-043, E2E-WORKFLOW-044, E2E-WORKFLOW-045, E2E-WORKFLOW-046, E2E-WORKFLOW-055

## 前提条件

### テストアカウント
- コーチ: coach@rag-base.local / TestCoach2025!
- クライアント: client1@rag-base.local / TestClient2025!

### テスト環境
- モックAPIサービス: `mockWorkflowService.ts`使用
- ブラウザ: Chrome最新版、Edge最新版、Firefox最新版（PC想定）
- デバイス:
  - デスクトップ: 1920x1080px（推奨）、1366x768px（最小）
  - タブレット: 768x1024px（MVP段階では対応不要）
  - モバイル: 375x667px（MVP段階では対応不要）

### モックデータ
- アプリID: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`
- ノード総数: 8ノード
- エッジ総数: 7エッジ
- 危機検出キーワード: 「死にたい」「消えたい」「辛い」「苦しい」「助けて」
- 応答遅延（ワークフロー取得）: 800ms
- 応答遅延（ワークフロー実行テスト）: 2000ms

## テスト実施時の注意事項

### 1. PC画面テスト（MVP段階の主要ターゲット）
- デスクトップブラウザ（Chrome、Edge、Firefox）で確認
- 1920x1080pxまたは1366x768pxの画面解像度を推奨
- マウス操作とキーボード操作の両方を確認

### 2. SVGキャンバステスト
- ブラウザ開発者ツールでSVG要素を検証
- ノード位置がposition.x, position.yに基づいて正確に配置されているか確認
- 接続線がノード間を正確に結んでいるか確認

### 3. ワークフロー実行テスト
- 通常ルート（危機キーワードなし）と危機ルート（危機キーワードあり）の両方をテスト
- 実行ログの各ノードのstatus（success/error/skipped）を確認
- 総実行時間が3-5秒以内であることを確認

### 4. セキュリティテスト
- クライアントロールでのアクセス制御を重点確認
- ブラウザコンソールでAPI直接アクセスを試行
- トークン期限切れの挙動を確認

### 5. パフォーマンステスト
- Chrome DevToolsのNetworkタブでAPI応答時間を測定
- Lighthouseスコア目標: Performance 90以上

### 6. エラーハンドリングテスト
- Chrome DevToolsでネットワークをオフライン化
- エラーアラートの表示を確認
- コンソールエラーログを確認

## 既知の制限事項（MVP段階）

### 1. ノード編集機能未実装
- ノードの追加・削除・位置変更は未実装
- ノード設定の編集は未実装（読み取り専用）
- 本番化時に実装予定

### 2. ワークフロー保存機能未実装
- 「保存」ボタンクリック時はアラート表示のみ
- 変更は保存されない
- 本番化時に実装予定

### 3. 元に戻す機能未実装
- 「元に戻す」ボタンクリック時はアラート表示のみ
- 変更の取り消しは不可
- 本番化時に実装予定

### 4. スマホ・タブレット対応なし
- MVP段階ではPC専用
- レスポンシブデザインは未実装
- 本番化時に対応予定

### 5. リアルタイム更新なし
- ワークフローの自動更新機能なし
- ページリロードで最新データを取得

## テスト完了基準

### 全体完了基準
- 高優先度テスト: 100%成功（36/36）
- 中優先度テスト: 90%以上成功（17/18以上）
- 低優先度テスト: 80%以上成功（7/8以上）

### デバイス別完了基準
- デスクトップ: すべての高優先度テスト成功
- タブレット: MVP段階ではテスト不要
- モバイル: MVP段階ではテスト不要

### セキュリティ完了基準
- E2E-WORKFLOW-002, E2E-WORKFLOW-003, E2E-WORKFLOW-033, E2E-WORKFLOW-034, E2E-WORKFLOW-035: すべて成功

### パフォーマンス完了基準
- 初期ロード: 3秒以内
- ワークフロー取得API: 1秒以内（モック）
- ワークフロー実行テストAPI: 3-5秒以内（モック）
- Lighthouse Performance: 90以上

### ワークフロー実行完了基準
- 通常ルート（E2E-WORKFLOW-047）: 成功
- 危機ルート（E2E-WORKFLOW-048）: 成功
- 8ノードの実行ログがすべて正しく表示される

## 参考資料
- 要件定義書: `docs/requirements.md` - D-008仕様
- API仕様書: `docs/api-specs/workflow-editor-api.md`
- 実装ファイル: `frontend/src/pages/WorkflowEditorPage/index.tsx`
- モックサービス: `frontend/src/services/api/mockWorkflowService.ts`
- 型定義: `frontend/src/types/index.ts`

---

**作成日**: 2025-11-02
**バージョン**: MVP v1.0
**次回更新予定**: テスト実施完了後
