# AdminConversationHistoryPage（D-006）E2Eテスト仕様書

生成日: 2025-11-02
対象ページ: /admin/conversation-history
テスト環境: モック実装
作成者: E2Eテスト設計サブエージェント

## 概要
- 総テスト項目数: 72
- 高優先度: 45項目
- 中優先度: 20項目
- 低優先度: 7項目

## テスト項目一覧

| No | テストID | テスト項目 | 依存テストID | 機能分類 | テスト分類 | 優先度 | 確認内容 | テストデータ/手順 | 期待結果 | 実施日 | 結果 | 備考 |
|----|---------|----------|------------|---------|-----------|--------|---------|------------------|----------|--------|------|------|
| 1 | E2E-ACH-001 | ページアクセス（コーチロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | コーチロールでの会話履歴管理アクセス | 1. コーチアカウントでログイン（coach@rag-base.local）<br>2. `/admin/conversation-history`にアクセス | ・会話履歴管理ページが表示される<br>・ページタイトル「会話履歴管理」表示<br>・左側: セッション一覧（40%幅）<br>・右側: セッション詳細（60%幅） | | | |
| 2 | E2E-ACH-002 | ページアクセス（クライアントロール） | なし | 認証・アクセス制御 | セキュリティ | 高 | クライアントロールのアクセス拒否 | 1. クライアントアカウントでログイン（client1@rag-base.local）<br>2. `/admin/conversation-history`に直接アクセス | ・403 Forbiddenエラー表示<br>・または、クライアント向けチャットページ（/chat）にリダイレクト<br>・エラーメッセージ「管理者権限が必要です」表示 | | | |
| 3 | E2E-ACH-003 | ページアクセス（未認証） | なし | 認証・アクセス制御 | セキュリティ | 高 | 未ログイン時のアクセス制御 | 1. ログアウト状態<br>2. `/admin/conversation-history`に直接アクセス | ・ログインページにリダイレクト<br>・エラーメッセージ表示（要ログイン） | | | |
| 4 | E2E-ACH-004 | 全セッション一覧取得（成功） | E2E-ACH-001 | データ取得 | 正常系 | 高 | API呼び出しとセッション一覧表示 | 1. コーチアカウントでログイン<br>2. 会話履歴管理ページにアクセス<br>3. ネットワークタブでAPIリクエスト確認 | ・`GET /admin/conversations`が実行される<br>・ローディング表示が出る<br>・全クライアントのセッション一覧が正常に表示される（6件）<br>・エラーなし | | | |
| 5 | E2E-ACH-005 | セッションカード：基本情報表示 | E2E-ACH-004 | セッション一覧表示 | 正常系 | 高 | セッションカードの基本情報表示 | 1. 会話履歴管理ページ表示<br>2. セッションカードを確認 | ・セッション名「client1@example.comとの会話 - 2025-11-01」<br>・クライアント名「クライアント: client1@example.com」<br>・最終日時「最終: 2025/11/01 14:30」<br>・メッセージ数「15件」 | | | |
| 6 | E2E-ACH-006 | セッションカード：危機フラグ表示 | E2E-ACH-004 | セッション一覧表示 | 正常系 | 高 | 危機フラグの視覚的表示 | 1. 会話履歴管理ページ表示<br>2. crisis_flag=trueのセッションカードを確認 | ・赤色アイコン（WarningIcon）が表示される<br>・赤色左ボーダー（4px solid error.main）が表示される<br>・視覚的に危機フラグが強調される | | | |
| 7 | E2E-ACH-007 | セッションカード：危機フラグなし | E2E-ACH-004 | セッション一覧表示 | 正常系 | 高 | 危機フラグなしの表示 | 1. 会話履歴管理ページ表示<br>2. crisis_flag=falseのセッションカードを確認 | ・赤色アイコンなし<br>・赤色左ボーダーなし（透明ボーダー2px）<br>・通常表示 | | | |
| 8 | E2E-ACH-008 | セッションカードクリック（選択） | E2E-ACH-005 | セッション選択 | 正常系 | 高 | セッションカード選択時の表示変化 | 1. 会話履歴管理ページ表示<br>2. セッションカードをクリック | ・選択されたカードに青色ボーダー（2px solid primary.main）が表示される<br>・右側にメッセージ一覧が表示される<br>・`GET /admin/conversations/{session_id}/messages`が実行される | | | |
| 9 | E2E-ACH-009 | セッションカード切り替え | E2E-ACH-008 | セッション選択 | 正常系 | 高 | セッション切り替え時の表示 | 1. セッションA選択中<br>2. セッションBをクリック | ・セッションAのボーダーが消える<br>・セッションBに青色ボーダーが表示される<br>・右側のメッセージ一覧がセッションBのものに切り替わる<br>・新しい`GET /admin/conversations/{session_id}/messages`が実行される | | | |
| 10 | E2E-ACH-010 | フィルター：クライアント選択（全クライアント） | E2E-ACH-004 | フィルタリング機能 | 正常系 | 高 | 全クライアントフィルター | 1. 会話履歴管理ページ表示<br>2. クライアント選択で「全クライアント」を選択 | ・全セッション（6件）が表示される<br>・フィルター適用なし | | | |
| 11 | E2E-ACH-011 | フィルター：クライアント選択（個別） | E2E-ACH-004 | フィルタリング機能 | 正常系 | 高 | 個別クライアントフィルター | 1. 会話履歴管理ページ表示<br>2. クライアント選択で「client1@example.com」を選択 | ・client1のセッションのみ表示される（3件）<br>・他クライアントのセッションは非表示 | | | |
| 12 | E2E-ACH-012 | フィルター：危機フラグチェックボックス | E2E-ACH-004 | フィルタリング機能 | 正常系 | 高 | 危機フラグフィルター | 1. 会話履歴管理ページ表示<br>2. 「危機フラグのみ表示」チェックボックスをON | ・crisis_flag=trueのセッションのみ表示される（2件）<br>・crisis_flag=falseのセッションは非表示 | | | |
| 13 | E2E-ACH-013 | フィルター：セッション名検索 | E2E-ACH-004 | フィルタリング機能 | 正常系 | 高 | セッション名検索フィルター | 1. 会話履歴管理ページ表示<br>2. 検索フィールドに「2025-11-01」と入力 | ・タイトルに「2025-11-01」を含むセッションのみ表示される（2件）<br>・他のセッションは非表示 | | | |
| 14 | E2E-ACH-014 | フィルター：複数フィルター同時適用 | E2E-ACH-011, E2E-ACH-012 | フィルタリング機能 | 正常系 | 高 | 複数フィルターの同時適用 | 1. 会話履歴管理ページ表示<br>2. クライアント選択で「client1@example.com」を選択<br>3. 「危機フラグのみ表示」チェックボックスをON | ・client1かつcrisis_flag=trueのセッションのみ表示される（1件）<br>・両方の条件を満たすセッションのみ表示 | | | |
| 15 | E2E-ACH-015 | フィルター：検索結果0件 | E2E-ACH-013 | フィルタリング機能 | 異常系 | 中 | 検索結果0件の表示 | 1. 会話履歴管理ページ表示<br>2. 検索フィールドに「存在しないキーワード」と入力 | ・「該当するセッションがありません」メッセージ表示<br>・セッションカードは表示されない | | | |
| 16 | E2E-ACH-016 | メッセージ一覧取得（成功） | E2E-ACH-008 | データ取得 | 正常系 | 高 | メッセージ一覧の表示 | 1. セッションカード選択<br>2. ネットワークタブでAPIリクエスト確認 | ・`GET /admin/conversations/{session_id}/messages`が実行される<br>・メッセージ一覧が表示される<br>・ユーザーメッセージとアシスタントメッセージが交互に表示される | | | |
| 17 | E2E-ACH-017 | メッセージ一覧：ユーザーメッセージ表示 | E2E-ACH-016 | メッセージ一覧表示 | 正常系 | 高 | ユーザーメッセージの表示 | 1. セッション選択<br>2. メッセージ一覧を確認 | ・右寄せ表示<br>・青色背景（primary.main）<br>・白色テキスト<br>・タイムスタンプ表示（例: 14:20） | | | |
| 18 | E2E-ACH-018 | メッセージ一覧：アシスタントメッセージ表示 | E2E-ACH-016 | メッセージ一覧表示 | 正常系 | 高 | アシスタントメッセージの表示 | 1. セッション選択<br>2. メッセージ一覧を確認 | ・左寄せ表示<br>・グレー背景（grey.100）<br>・黒色テキスト（text.primary）<br>・タイムスタンプ表示（例: 14:21） | | | |
| 19 | E2E-ACH-019 | メッセージ一覧：危機検出バッジ表示 | E2E-ACH-016 | メッセージ一覧表示 | 正常系 | 高 | 危機検出バッジの表示 | 1. セッション選択<br>2. crisis_detected=trueのメッセージを確認 | ・メッセージバブルに赤色ボーダー（2px solid error.main）<br>・赤色バッジ「危機キーワード検出」表示（WarningIcon + テキスト）<br>・視覚的に強調される | | | |
| 20 | E2E-ACH-020 | メッセージ一覧：危機検出なし | E2E-ACH-016 | メッセージ一覧表示 | 正常系 | 高 | 危機検出なしの表示 | 1. セッション選択<br>2. crisis_detected=falseのメッセージを確認 | ・通常のボーダー（ボーダーなし）<br>・危機検出バッジなし<br>・通常表示 | | | |
| 21 | E2E-ACH-021 | メッセージ一覧：時刻表示 | E2E-ACH-016 | メッセージ一覧表示 | 正常系 | 高 | タイムスタンプの表示 | 1. セッション選択<br>2. メッセージ一覧のタイムスタンプを確認 | ・各メッセージの下に時刻表示（例: 14:20）<br>・caption variant、text.secondary色<br>・フォーマット: HH:mm | | | |
| 22 | E2E-ACH-022 | 引用元情報：Accordion表示 | E2E-ACH-016 | 引用元情報表示 | 正常系 | 中 | 引用元情報の折りたたみ表示 | 1. セッション選択<br>2. アシスタントメッセージの引用元情報を確認 | ・Accordionコンポーネントで表示<br>・折りたたみ状態（デフォルト）<br>・ヘッダー「引用元」（AutoAwesomeIcon + テキスト、primary.main色） | | | |
| 23 | E2E-ACH-023 | 引用元情報：Accordion展開 | E2E-ACH-022 | 引用元情報表示 | 正常系 | 中 | 引用元情報の展開 | 1. セッション選択<br>2. 引用元情報のAccordionをクリック | ・Accordionが展開される<br>・引用元情報が表示される（システムRAG、ユーザーRAG） | | | |
| 24 | E2E-ACH-024 | 引用元情報：システムRAG表示 | E2E-ACH-023 | 引用元情報表示 | 正常系 | 中 | システムRAGの引用元情報 | 1. セッション選択<br>2. 引用元情報を展開<br>3. システムRAG情報を確認 | ・「システムRAG: 「コーチング基礎理論.pdf」(チャンク 45)」<br>・類似度スコア「0.89」表示<br>・caption variant、text.secondary色 | | | |
| 25 | E2E-ACH-025 | 引用元情報：ユーザーRAG表示 | E2E-ACH-023 | 引用元情報表示 | 正常系 | 中 | ユーザーRAGの引用元情報 | 1. セッション選択<br>2. 引用元情報を展開<br>3. ユーザーRAG情報を確認 | ・「ユーザーRAG: 「client1のタスク履歴」(チャンク 12)」<br>・類似度スコア「0.82」表示<br>・caption variant、text.secondary色 | | | |
| 26 | E2E-ACH-026 | 引用元情報：複数引用 | E2E-ACH-023 | 引用元情報表示 | 正常系 | 中 | 複数引用元の表示 | 1. セッション選択<br>2. 引用元情報を展開<br>3. 複数引用元を確認 | ・システムRAGとユーザーRAGが両方表示される（2件）<br>・各引用元が順に表示される<br>・各引用元にチャンク番号と類似度スコア表示 | | | |
| 27 | E2E-ACH-027 | セッション詳細ヘッダー：セッション名表示 | E2E-ACH-016 | セッション詳細表示 | 正常系 | 高 | セッション詳細ヘッダーの表示 | 1. セッション選択<br>2. 右側のセッション詳細ヘッダーを確認 | ・セッション名「client1@example.comとの会話 - 2025-11-01」表示<br>・h6 variant、fontWeight 500<br>・グレー背景（grey.50） | | | |
| 28 | E2E-ACH-028 | セッション詳細ヘッダー：危機フラグChip表示 | E2E-ACH-016 | セッション詳細表示 | 正常系 | 高 | 危機フラグChipの表示 | 1. crisis_flag=trueのセッション選択<br>2. セッション詳細ヘッダーを確認 | ・赤色Chip「危機フラグ」表示（WarningIcon + テキスト）<br>・color="error"、size="small"<br>・セッション名の右側に配置 | | | |
| 29 | E2E-ACH-029 | セッション詳細ヘッダー：セッションID表示 | E2E-ACH-016 | セッション詳細表示 | 正常系 | 高 | セッションIDの表示 | 1. セッション選択<br>2. セッション詳細ヘッダーを確認 | ・「セッションID: session-001」表示<br>・caption variant、text.secondary色<br>・セッション名の下に表示 | | | |
| 30 | E2E-ACH-030 | 空の状態表示（セッション未選択） | E2E-ACH-001 | UI表示 | 正常系 | 中 | セッション未選択時の空の状態 | 1. 会話履歴管理ページにアクセス<br>2. セッションを選択しない状態<br>3. 右側のセッション詳細エリアを確認 | ・ChatBubbleOutlineIcon（80px、text.disabled）表示<br>・「左側のセッション一覧からセッションを選択してください」テキスト表示<br>・中央配置、縦横センタリング | | | |
| 31 | E2E-ACH-031 | レイアウト：2カラム（デスクトップ） | E2E-ACH-001 | UI表示 | 正常系 | 中 | デスクトップ画面での2カラムレイアウト | 1. ブラウザ幅1920pxに設定<br>2. 会話履歴管理ページ表示 | ・左側: セッション一覧（40%幅、Grid size={{ xs: 12, md: 5 }}）<br>・右側: セッション詳細（60%幅、Grid size={{ xs: 12, md: 7 }}）<br>・2カラムが横並び表示<br>・高さ: calc(100vh - 200px) | | | |
| 32 | E2E-ACH-032 | レイアウト：1カラム（タブレット） | E2E-ACH-001 | UI表示 | レスポンシブ | 低 | タブレット画面での1カラムレイアウト | 1. ブラウザ幅768pxに設定<br>2. 会話履歴管理ページ表示 | ・1カラムレイアウト（縦並び）<br>・セッション一覧が上部<br>・セッション詳細が下部<br>・縦スクロール可能 | | | |
| 33 | E2E-ACH-033 | レイアウト：1カラム（モバイル） | E2E-ACH-001 | UI表示 | レスポンシブ | 低 | モバイル画面での1カラムレイアウト | 1. ブラウザ幅375pxに設定<br>2. 会話履歴管理ページ表示 | ・1カラムレイアウト（縦並び）<br>・セッション一覧が上部<br>・セッション詳細が下部<br>・縦スクロール可能<br>・横スクロールなし | | | |
| 34 | E2E-ACH-034 | ローディング表示：セッション一覧 | E2E-ACH-001 | データ取得 | 正常系 | 中 | セッション一覧取得中のローディング | 1. 会話履歴管理ページにアクセス<br>2. APIレスポンス前の状態を確認 | ・ローディングスピナー（CircularProgress）表示<br>・中央配置、縦横センタリング<br>・最小高さ: 80vh<br>・セッション一覧カード非表示 | | | |
| 35 | E2E-ACH-035 | ローディング表示：メッセージ一覧 | E2E-ACH-008 | データ取得 | 正常系 | 中 | メッセージ一覧取得中のローディング | 1. セッションカード選択<br>2. APIレスポンス前の状態を確認 | ・ローディングスピナー表示（右側セッション詳細エリア）<br>・メッセージ一覧非表示<br>・セッション詳細ヘッダーは表示 | | | |
| 36 | E2E-ACH-036 | エラーハンドリング：セッション一覧取得エラー | E2E-ACH-001 | エラーハンドリング | 異常系 | 高 | API接続エラー時のエラー表示 | 1. ネットワークを切断<br>2. 会話履歴管理ページにアクセス | ・エラーアラート表示（MUI Alert、severity="error"）<br>・メッセージ「会話一覧の取得に失敗しました」<br>・セッション一覧カード非表示<br>・コンソールにエラーログ出力 | | | |
| 37 | E2E-ACH-037 | エラーハンドリング：メッセージ一覧取得エラー | E2E-ACH-008 | エラーハンドリング | 異常系 | 高 | メッセージ一覧取得エラー | 1. セッションカード選択<br>2. モックAPIを404エラーに設定<br>3. ネットワークタブで確認 | ・エラーアラート表示<br>・メッセージ「メッセージの取得に失敗しました」<br>・メッセージ一覧非表示<br>・コンソールにエラーログ出力 | | | |
| 38 | E2E-ACH-038 | セキュリティ：他ロールのアクセス試行 | E2E-ACH-002 | セキュリティ | セキュリティ | 高 | クライアントロールでの不正アクセス防止 | 1. クライアントアカウントでログイン<br>2. URLを直接入力して`/admin/conversation-history`にアクセス<br>3. ブラウザ開発者ツールでリクエスト確認 | ・403 Forbiddenエラー<br>・または、/chatにリダイレクト<br>・APIリクエストは送信されない（フロントエンド側で制御）<br>・または、APIが403を返す（バックエンド側で制御） | | | |
| 39 | E2E-ACH-039 | セキュリティ：APIエンドポイントの直接アクセス | E2E-ACH-001 | セキュリティ | セキュリティ | 高 | クライアントロールによるAPI直接アクセス防止 | 1. クライアントアカウントでログイン<br>2. ブラウザコンソールで`fetch('/admin/conversations')`を実行 | ・403 Forbiddenエラー<br>・エラーレスポンス:<br>　{<br>　　"error": "forbidden",<br>　　"message": "コーチロールのみアクセス可能です",<br>　　"status": 403<br>　} | | | |
| 40 | E2E-ACH-040 | セキュリティ：トークン期限切れ | E2E-ACH-001 | セキュリティ | セキュリティ | 高 | トークン期限切れ時の挙動 | 1. コーチアカウントでログイン<br>2. トークン有効期限を過ぎた状態をシミュレート（localStorageのトークンを削除）<br>3. 会話履歴管理ページにアクセス | ・401 Unauthorizedエラー<br>・ログインページにリダイレクト<br>・エラーメッセージ「セッションが期限切れです。再度ログインしてください。」 | | | |
| 41 | E2E-ACH-041 | パフォーマンス：初期ロード時間 | E2E-ACH-001 | パフォーマンス | 正常系 | 中 | ページ初期ロード速度 | 1. ページロード時のパフォーマンスを測定 | ・ページが3秒以内に表示される<br>・セッション一覧API呼び出し完了まで500ms以内（モック500ms遅延）<br>・First Contentful Paint < 1.5秒<br>・Time to Interactive < 3秒 | | | |
| 42 | E2E-ACH-042 | パフォーマンス：メッセージ一覧取得時間 | E2E-ACH-008 | パフォーマンス | 正常系 | 中 | メッセージ一覧API応答時間 | 1. セッションカード選択<br>2. ネットワークタブでAPI応答時間を測定 | ・APIレスポンスが1秒以内（モック500ms遅延）<br>・本番環境では1秒以内を目標 | | | |
| 43 | E2E-ACH-043 | ワークフロー：初回アクセスからメッセージ閲覧まで | なし | ワークフロー | 正常系 | 高 | コーチが初めて会話履歴管理にアクセスし、メッセージを閲覧 | 1. コーチアカウントでログイン<br>2. 会話履歴管理ページにアクセス<br>3. セッション一覧確認<br>4. セッションカードをクリック<br>5. メッセージ一覧確認 | ・セッション一覧が表示される（6件）<br>・セッションカードが選択される（青色ボーダー）<br>・メッセージ一覧が表示される<br>・ユーザーメッセージとアシスタントメッセージが交互に表示される | | | |
| 44 | E2E-ACH-044 | ワークフロー：危機フラグセッションの確認 | E2E-ACH-043 | ワークフロー | 正常系 | 高 | コーチが危機フラグセッションを確認 | 1. 会話履歴管理ページにアクセス<br>2. 危機フラグフィルターをON<br>3. 危機フラグセッションを選択<br>4. 危機検出メッセージを確認 | ・危機フラグセッションのみ表示される（2件）<br>・セッションカードに赤色アイコンと左ボーダー<br>・セッション詳細ヘッダーに赤色Chip「危機フラグ」<br>・メッセージ一覧でcrisis_detected=trueのメッセージに赤色ボーダーとバッジ | | | |
| 45 | E2E-ACH-045 | ワークフロー：クライアント別フィルタリング | E2E-ACH-043 | ワークフロー | 正常系 | 中 | コーチが特定クライアントの会話履歴を確認 | 1. 会話履歴管理ページにアクセス<br>2. クライアント選択で「client1@example.com」を選択<br>3. セッション一覧確認<br>4. セッションを選択<br>5. メッセージ一覧確認 | ・client1のセッションのみ表示される（3件）<br>・セッションを選択<br>・メッセージ一覧が表示される | | | |
| 46 | E2E-ACH-046 | ワークフロー：引用元情報の確認 | E2E-ACH-043 | ワークフロー | 正常系 | 中 | コーチが引用元情報を確認 | 1. 会話履歴管理ページにアクセス<br>2. セッション選択<br>3. アシスタントメッセージの引用元情報を展開<br>4. システムRAGとユーザーRAGを確認 | ・引用元情報のAccordionをクリック<br>・システムRAG「コーチング基礎理論.pdf」(チャンク 45)、類似度0.89<br>・ユーザーRAG「client1のタスク履歴」(チャンク 12)、類似度0.82<br>・両方の引用元が表示される | | | |
| 47 | E2E-ACH-047 | ワークフロー：複数フィルター適用と解除 | E2E-ACH-043 | ワークフロー | 正常系 | 中 | コーチが複数フィルターを適用して解除 | 1. 会話履歴管理ページにアクセス<br>2. クライアント選択で「client1@example.com」を選択<br>3. 危機フラグフィルターをON<br>4. セッション一覧確認<br>5. フィルターを解除 | ・client1かつcrisis_flag=trueのセッションのみ表示される（1件）<br>・クライアント選択を「全クライアント」に戻す<br>・危機フラグフィルターをOFF<br>・全セッション（6件）が表示される | | | |
| 48 | E2E-ACH-048 | ブラウザ互換性：Chrome | E2E-ACH-001 | ブラウザ互換性 | 正常系 | 高 | Chrome最新版での動作確認 | 1. Chrome最新版を使用<br>2. 会話履歴管理ページにアクセス | ・すべての要素が正常に表示される<br>・セッション一覧、メッセージ一覧が正しく動作<br>・フィルター機能が正常 | | | |
| 49 | E2E-ACH-049 | ブラウザ互換性：Edge | E2E-ACH-001 | ブラウザ互換性 | 正常系 | 中 | Edge最新版での動作確認 | 1. Edge最新版を使用<br>2. 会話履歴管理ページにアクセス | ・すべての要素が正常に表示される<br>・Chromeと同様の挙動 | | | |
| 50 | E2E-ACH-050 | ブラウザ互換性：Firefox | E2E-ACH-001 | ブラウザ互換性 | 正常系 | 中 | Firefox最新版での動作確認 | 1. Firefox最新版を使用<br>2. 会話履歴管理ページにアクセス | ・すべての要素が正常に表示される<br>・フィルター機能、メッセージ表示が正常 | | | |
| 51 | E2E-ACH-051 | エッジケース：セッション0件 | E2E-ACH-001 | エッジケース | 異常系 | 低 | セッションが1件もない場合 | 1. モックデータでセッション0件を設定<br>2. 会話履歴管理ページにアクセス | ・「該当するセッションがありません」表示<br>・セッションカードは表示されない<br>・右側は空の状態表示 | | | |
| 52 | E2E-ACH-052 | エッジケース：メッセージ0件 | E2E-ACH-008 | エッジケース | 異常系 | 低 | メッセージが1件もないセッション | 1. モックデータでメッセージ0件のセッションを作成<br>2. そのセッションを選択 | ・メッセージ一覧に「メッセージがありません」表示<br>・セッション詳細ヘッダーは表示される | | | |
| 53 | E2E-ACH-053 | エッジケース：セッション100件以上 | E2E-ACH-001 | エッジケース | 異常系 | 低 | セッションが100件以上ある場合 | 1. モックデータでセッション100件を作成<br>2. 会話履歴管理ページにアクセス | ・セッション一覧が正常に表示される<br>・縦スクロール可能<br>・パフォーマンス問題なし<br>・MVP段階ではページネーションなし（全件表示） | | | |
| 54 | E2E-ACH-054 | エッジケース：長いセッション名 | E2E-ACH-005 | エッジケース | 異常系 | 低 | セッション名が非常に長い場合 | 1. モックデータで200文字のセッション名を作成<br>2. 会話履歴管理ページにアクセス | ・セッション名が表示される（省略表示または折り返し）<br>・レイアウトが崩れない<br>・カード内で適切に表示 | | | |
| 55 | E2E-ACH-055 | エッジケース：引用元情報0件 | E2E-ACH-016 | エッジケース | 異常系 | 低 | 引用元情報が0件のアシスタントメッセージ | 1. モックデータでcitations=[]のメッセージを作成<br>2. そのメッセージを確認 | ・引用元情報のAccordionは表示されない<br>・メッセージバブルは正常に表示される | | | |
| 56 | E2E-ACH-056 | 日時フォーマット：created_at表示 | E2E-ACH-005 | UI表示 | 正常系 | 低 | created_at日時のフォーマット表示 | 1. 会話履歴管理ページ表示<br>2. セッションカードの日時を確認 | ・フォーマット: YYYY/MM/DD HH:mm<br>・例: 「最終: 2025/11/01 14:30」<br>・日本語ロケール（ja-JP） | | | |
| 57 | E2E-ACH-057 | 日時フォーマット：timestamp表示 | E2E-ACH-017 | UI表示 | 正常系 | 低 | メッセージのタイムスタンプ表示 | 1. セッション選択<br>2. メッセージ一覧のタイムスタンプを確認 | ・フォーマット: HH:mm<br>・例: 「14:20」<br>・caption variant、text.secondary色 | | | |
| 58 | E2E-ACH-058 | スクロール：セッション一覧スクロール | E2E-ACH-004 | UI表示 | 正常系 | 中 | セッション一覧の縦スクロール | 1. 会話履歴管理ページ表示<br>2. セッション一覧が多数ある場合<br>3. 縦スクロール | ・セッション一覧が縦スクロール可能<br>・スクロールバー表示<br>・カードが一覧表示される | | | |
| 59 | E2E-ACH-059 | スクロール：メッセージ一覧スクロール | E2E-ACH-016 | UI表示 | 正常系 | 中 | メッセージ一覧の縦スクロール | 1. セッション選択<br>2. メッセージ一覧が多数ある場合<br>3. 縦スクロール | ・メッセージ一覧が縦スクロール可能<br>・スクロールバー表示<br>・メッセージが順に表示される | | | |
| 60 | E2E-ACH-060 | カラーテーマ：危機フラグ赤色強調 | E2E-ACH-006 | UI表示 | 正常系 | 高 | 危機フラグの赤色強調表示 | 1. 会話履歴管理ページ表示<br>2. crisis_flag=trueのセッションカードを確認<br>3. 危機検出メッセージを確認 | ・セッションカード: 赤色アイコン（error.main）、赤色左ボーダー（4px solid error.main）<br>・セッション詳細ヘッダー: 赤色Chip（color="error"）<br>・メッセージ: 赤色ボーダー（2px solid error.main）、赤色バッジ（color="error"） | | | |
| 61 | E2E-ACH-061 | カラーテーマ：選択状態青色強調 | E2E-ACH-008 | UI表示 | 正常系 | 高 | 選択状態の青色強調表示 | 1. 会話履歴管理ページ表示<br>2. セッションカードをクリック | ・選択されたカード: 青色ボーダー（2px solid primary.main）<br>・非選択カード: 透明ボーダー（2px solid transparent） | | | |
| 62 | E2E-ACH-062 | カラーテーマ：ユーザーメッセージ青色 | E2E-ACH-017 | UI表示 | 正常系 | 高 | ユーザーメッセージの青色背景 | 1. セッション選択<br>2. ユーザーメッセージを確認 | ・背景色: primary.main（青色）<br>・テキスト色: white<br>・右寄せ表示 | | | |
| 63 | E2E-ACH-063 | カラーテーマ：アシスタントメッセージグレー | E2E-ACH-018 | UI表示 | 正常系 | 高 | アシスタントメッセージのグレー背景 | 1. セッション選択<br>2. アシスタントメッセージを確認 | ・背景色: grey.100（グレー）<br>・テキスト色: text.primary（黒）<br>・左寄せ表示 | | | |
| 64 | E2E-ACH-064 | アクセシビリティ：キーボード操作 | E2E-ACH-001 | アクセシビリティ | 正常系 | 低 | キーボードでのナビゲーション | 1. 会話履歴管理ページ表示<br>2. Tabキーでフォーカス移動<br>3. Enterキーでセッション選択 | ・Tabキーでフォーカス移動可能<br>・フォーカス状態が視覚的に表示される<br>・Enterキーでセッション選択可能 | | | |
| 65 | E2E-ACH-065 | アクセシビリティ：スクリーンリーダー | E2E-ACH-001 | アクセシビリティ | 正常系 | 低 | スクリーンリーダーでの読み上げ | 1. スクリーンリーダー（NVDA/JAWS）を使用<br>2. 会話履歴管理ページにアクセス<br>3. セッション一覧、メッセージ一覧を確認 | ・セッション名、クライアント名、日時が読み上げられる<br>・メッセージ内容が読み上げられる<br>・危機フラグ、危機検出バッジが読み上げられる | | | |
| 66 | E2E-ACH-066 | UI状態：ホバー効果 | E2E-ACH-004 | UI表示 | 正常系 | 低 | セッションカードのホバー効果 | 1. 会話履歴管理ページ表示<br>2. セッションカードにマウスオーバー | ・ホバー時に背景色が変化（action.hover）<br>・カーソルがpointer表示 | | | |
| 67 | E2E-ACH-067 | UI状態：クリック効果 | E2E-ACH-008 | UI表示 | 正常系 | 低 | セッションカードのクリック効果 | 1. 会話履歴管理ページ表示<br>2. セッションカードをクリック | ・クリック時に即座に選択状態になる<br>・青色ボーダーが表示される<br>・メッセージ一覧が読み込まれる | | | |
| 68 | E2E-ACH-068 | 統合テスト：全機能連続操作 | なし | 統合テスト | 正常系 | 高 | すべての機能を連続して操作 | 1. コーチアカウントでログイン<br>2. 会話履歴管理ページにアクセス<br>3. セッション一覧確認<br>4. クライアントフィルター適用<br>5. 危機フラグフィルター適用<br>6. セッション検索<br>7. セッション選択<br>8. メッセージ一覧確認<br>9. 引用元情報展開<br>10. 別セッション選択<br>11. フィルター解除<br>12. 全セッション一覧に戻る | ・すべての機能が正常に動作する<br>・エラーなし<br>・パフォーマンス問題なし<br>・UI表示が正常 | | | |
| 69 | E2E-ACH-069 | リグレッションテスト：初回アクセス | E2E-ACH-001 | リグレッション | 正常系 | 高 | 初回アクセス時の動作確認 | 1. ブラウザキャッシュをクリア<br>2. localStorageをクリア<br>3. コーチアカウントでログイン<br>4. 会話履歴管理ページにアクセス | ・初回アクセスでも正常に表示される<br>・セッション一覧が読み込まれる<br>・最初のセッションが自動選択される（初期実装） | | | |
| 70 | E2E-ACH-070 | リグレッションテスト：ページリロード | E2E-ACH-043 | リグレッション | 正常系 | 中 | ページリロード時の動作確認 | 1. 会話履歴管理ページにアクセス<br>2. セッション選択<br>3. フィルター適用<br>4. ページをリロード（F5） | ・ページがリロードされる<br>・セッション一覧が再取得される<br>・フィルター状態は保持されない（リセット）<br>・選択状態は保持されない（初期状態に戻る） | | | |
| 71 | E2E-ACH-071 | リグレッションテスト：ネットワーク復帰 | E2E-ACH-036 | リグレッション | 異常系 | 中 | ネットワーク復帰後の再読み込み | 1. 会話履歴管理ページにアクセス<br>2. ネットワークを切断（エラー発生）<br>3. ネットワークを復帰<br>4. ページをリロード | ・エラーアラート表示<br>・ネットワーク復帰後、リロード<br>・セッション一覧が正常に取得される<br>・エラー状態が解消される | | | |
| 72 | E2E-ACH-072 | リグレッションテスト：連続API呼び出し | E2E-ACH-009 | リグレッション | 正常系 | 中 | セッション連続切り替え時の動作確認 | 1. 会話履歴管理ページにアクセス<br>2. セッションAを選択<br>3. 即座にセッションBを選択<br>4. 即座にセッションCを選択 | ・各セッション選択時にメッセージ一覧が取得される<br>・前のAPIリクエストがキャンセルされる（オプション）<br>・最終的にセッションCのメッセージが表示される<br>・エラーなし | | | |

## テスト分類別カバレッジ
- 正常系: 49項目
- 異常系: 10項目
- セキュリティ: 6項目
- レスポンシブ: 3項目
- ワークフロー: 5項目
- パフォーマンス: 2項目
- エッジケース: 6項目
- ブラウザ互換性: 3項目
- アクセシビリティ: 2項目
- 統合テスト: 1項目
- リグレッション: 4項目

## API呼び出し一覧
| No | メソッド | エンドポイント | 用途 | 対応テストID |
|----|---------|--------------|------|-------------|
| 1 | GET | `/admin/conversations` | 全クライアントの会話一覧取得 | E2E-ACH-004, E2E-ACH-036 |
| 2 | GET | `/admin/conversations/{session_id}/messages` | 会話詳細（メッセージ一覧）取得 | E2E-ACH-016, E2E-ACH-037 |

## 優先度別実施順序

### 1. 高優先度（必須）: 45項目
E2E-ACH-001, E2E-ACH-002, E2E-ACH-003, E2E-ACH-004, E2E-ACH-005, E2E-ACH-006, E2E-ACH-007, E2E-ACH-008, E2E-ACH-009, E2E-ACH-010, E2E-ACH-011, E2E-ACH-012, E2E-ACH-013, E2E-ACH-014, E2E-ACH-016, E2E-ACH-017, E2E-ACH-018, E2E-ACH-019, E2E-ACH-020, E2E-ACH-021, E2E-ACH-027, E2E-ACH-028, E2E-ACH-029, E2E-ACH-036, E2E-ACH-037, E2E-ACH-038, E2E-ACH-039, E2E-ACH-040, E2E-ACH-043, E2E-ACH-044, E2E-ACH-048, E2E-ACH-060, E2E-ACH-061, E2E-ACH-062, E2E-ACH-063, E2E-ACH-068, E2E-ACH-069

### 2. 中優先度（推奨）: 20項目
E2E-ACH-015, E2E-ACH-022, E2E-ACH-023, E2E-ACH-024, E2E-ACH-025, E2E-ACH-026, E2E-ACH-030, E2E-ACH-031, E2E-ACH-034, E2E-ACH-035, E2E-ACH-041, E2E-ACH-042, E2E-ACH-045, E2E-ACH-046, E2E-ACH-047, E2E-ACH-049, E2E-ACH-050, E2E-ACH-058, E2E-ACH-059, E2E-ACH-070, E2E-ACH-071, E2E-ACH-072

### 3. 低優先度（任意）: 7項目
E2E-ACH-032, E2E-ACH-033, E2E-ACH-051, E2E-ACH-052, E2E-ACH-053, E2E-ACH-054, E2E-ACH-055, E2E-ACH-056, E2E-ACH-057, E2E-ACH-064, E2E-ACH-065, E2E-ACH-066, E2E-ACH-067

## 前提条件

### テストアカウント
- コーチ: coach@rag-base.local / TestCoach2025!
- クライアント: client1@rag-base.local / TestClient2025!

### テスト環境
- モックAPIサービス: `mockAdminConversationService.ts`使用
- ブラウザ: Chrome最新版、Edge最新版、Firefox最新版（PC想定）
- デバイス:
  - デスクトップ: 1920x1080px（推奨）
  - タブレット: 768x1024px（任意）
  - モバイル: 375x667px（MVP段階では対応不要）

### モックデータ

#### セッション一覧（6件）
```typescript
[
  {
    session_id: 'session-001',
    user_id: 'client1@example.com',
    title: 'client1@example.comとの会話 - 2025-11-01',
    created_at: '2025-11-01T14:20:00Z',
    updated_at: '2025-11-01T14:30:00Z',
    message_count: 15,
    crisis_flag: true, // 危機フラグあり
  },
  {
    session_id: 'session-002',
    user_id: 'client2@example.com',
    title: 'client2@example.comとの会話 - 2025-11-01',
    created_at: '2025-11-01T10:00:00Z',
    updated_at: '2025-11-01T10:15:00Z',
    message_count: 8,
    crisis_flag: false,
  },
  {
    session_id: 'session-005',
    user_id: 'client2@example.com',
    title: 'client2@example.comとの会話 - 2025-10-28',
    created_at: '2025-10-28T12:30:00Z',
    updated_at: '2025-10-28T13:00:00Z',
    message_count: 18,
    crisis_flag: true, // 危機フラグあり
  },
  // ... 他3件（crisis_flag=false）
]
```

#### メッセージ一覧（session-001: 5件）
```typescript
[
  {
    message_id: 'message-001',
    session_id: 'session-001',
    role: 'user',
    content: '最近、仕事のプレッシャーがひどくて、朝起きるのがつらいです。',
    created_at: '2025-11-01T14:20:00Z',
    timestamp: '14:20',
    crisis_detected: false,
  },
  {
    message_id: 'message-002',
    session_id: 'session-001',
    role: 'assistant',
    content: 'そうなんですね。プレッシャーを感じていらっしゃるんですね。...',
    citations: [
      {
        source: 'コーチング基礎理論.pdf',
        content: '傾聴のスキルは、クライアントの真の課題を引き出すために重要です。',
        dataset_type: 'system',
        chunk_number: 45,
        similarity_score: 0.89,
      },
      {
        source: 'client1のタスク履歴',
        content: '先月のタスク管理状況を確認すると、複数のプロジェクトが同時進行していました。',
        dataset_type: 'user',
        chunk_number: 12,
        similarity_score: 0.82,
      },
    ],
    created_at: '2025-11-01T14:21:00Z',
    timestamp: '14:21',
    crisis_detected: false,
  },
  {
    message_id: 'message-003',
    session_id: 'session-001',
    role: 'user',
    content: '上司からの期待が大きすぎて、ミスが許されない気がします。最近は眠れない日もあります。',
    created_at: '2025-11-01T14:23:00Z',
    timestamp: '14:23',
    crisis_detected: true, // 危機キーワード検出
  },
  // ... 他2件
]
```

## テスト実施時の注意事項

### 1. PC画面テスト（MVP段階の主要ターゲット）
- デスクトップブラウザ（Chrome、Edge、Firefox）で確認
- 1920x1080pxの画面解像度を推奨
- マウス操作とキーボード操作の両方を確認

### 2. 危機フラグテスト
- 危機フラグ（crisis_flag）の視覚的表示を重点確認
- 危機検出（crisis_detected）の視覚的表示を重点確認
- 赤色強調表示が適切に動作することを確認

### 3. 引用元情報テスト
- システムRAGとユーザーRAGの区別を確認
- チャンク番号と類似度スコアの表示を確認
- Accordionの折りたたみ・展開動作を確認

### 4. フィルタリング機能テスト
- クライアント別フィルターの動作を確認
- 危機フラグフィルターの動作を確認
- 検索フィルターの動作を確認
- 複数フィルター同時適用を確認

### 5. セキュリティテスト
- クライアントロールでのアクセス制御を重点確認
- ブラウザコンソールでAPI直接アクセスを試行
- トークン期限切れの挙動を確認

### 6. パフォーマンステスト
- Chrome DevToolsのNetworkタブでAPI応答時間を測定
- Lighthouseスコア目標: Performance 90以上

### 7. エラーハンドリングテスト
- Chrome DevToolsでネットワークをオフライン化
- エラーアラートの表示を確認
- コンソールエラーログを確認

## 既知の制限事項（MVP段階）

### 1. ページネーション未実装
- セッション一覧は全件表示
- 100件以上のセッションがある場合、パフォーマンス低下の可能性
- 本番化時にページネーション実装予定

### 2. リアルタイム更新なし
- 新規メッセージのリアルタイム更新機能なし
- ページリロードで最新データを取得
- WebSocketによるリアルタイム更新は本番化時に実装予定

### 3. フィルター状態保存なし
- ページリロード時にフィルター状態はリセット
- localStorageへのフィルター状態保存機能なし
- 本番化時に実装予定

### 4. 選択状態保存なし
- ページリロード時に選択状態はリセット
- 初回アクセス時に最初のセッションが自動選択される（初期実装では選択なし）
- 本番化時にURL paramsで選択状態保存予定（例: /admin/conversation-history?session=session-001）

## テスト完了基準

### 全体完了基準
- 高優先度テスト: 100%成功（45/45）
- 中優先度テスト: 90%以上成功（18/20以上）
- 低優先度テスト: 80%以上成功（6/7以上）

### デバイス別完了基準
- デスクトップ: すべての高優先度テスト成功
- タブレット: レスポンシブテスト含む中優先度テスト成功
- モバイル: MVP段階ではテスト不要

### セキュリティ完了基準
- E2E-ACH-002, E2E-ACH-003, E2E-ACH-038, E2E-ACH-039, E2E-ACH-040: すべて成功

### パフォーマンス完了基準
- 初期ロード: 3秒以内
- セッション一覧取得: 500ms以内（モック500ms）
- メッセージ一覧取得: 1秒以内（モック500ms）
- Lighthouse Performance: 90以上

### 機能別完了基準
- セッション一覧表示: E2E-ACH-004, E2E-ACH-005, E2E-ACH-006, E2E-ACH-007 成功
- セッション選択: E2E-ACH-008, E2E-ACH-009 成功
- フィルタリング機能: E2E-ACH-010, E2E-ACH-011, E2E-ACH-012, E2E-ACH-013, E2E-ACH-014 成功
- メッセージ一覧: E2E-ACH-016, E2E-ACH-017, E2E-ACH-018, E2E-ACH-019, E2E-ACH-020, E2E-ACH-021 成功
- 引用元情報: E2E-ACH-022, E2E-ACH-023, E2E-ACH-024, E2E-ACH-025, E2E-ACH-026 成功（中優先度）
- 危機フラグ機能: E2E-ACH-006, E2E-ACH-019, E2E-ACH-028, E2E-ACH-044, E2E-ACH-060 成功

## 参考資料
- 要件定義書: `docs/requirements.md` - D-006仕様（295-312行目）
- API仕様書: `docs/api-specs/admin-conversation-history-api.md`
- 型定義: `frontend/src/types/index.ts`
- コンポーネント: `frontend/src/pages/AdminConversationHistoryPage/index.tsx`
- モックサービス: `frontend/src/services/api/mockAdminConversationService.ts`
- プロジェクト設定: `CLAUDE.md`

---

**作成日**: 2025-11-02
**バージョン**: MVP v1.0
**次回更新予定**: テスト実施完了後
